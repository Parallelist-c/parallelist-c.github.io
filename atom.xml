<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://parallelist-c.github.io</id>
    <title>Parallelist</title>
    <updated>2021-01-15T03:42:50.661Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://parallelist-c.github.io"/>
    <link rel="self" href="https://parallelist-c.github.io/atom.xml"/>
    <subtitle>æµ…ã„å¤¢ã ã‹ã‚‰ èƒ¸ã‚’ã¯ãªã‚Œãªã„</subtitle>
    <logo>https://parallelist-c.github.io/images/avatar.png</logo>
    <icon>https://parallelist-c.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, Parallelist</rights>
    <entry>
        <title type="html"><![CDATA[å¸é¢œåˆé›†]]></title>
        <id>https://parallelist-c.github.io/post/xi-yan-he-ji/</id>
        <link href="https://parallelist-c.github.io/post/xi-yan-he-ji/">
        </link>
        <updated>2021-01-15T01:33:27.000Z</updated>
        <content type="html"><![CDATA[<p>æ¯ç‡¥çš„ç«èµ›ç”Ÿæ´»éœ€è¦è‡ªå·±æ‰¾å¿«ä¹</p>
<hr>
<h2 id="æ¨è¶…è¶Š">æ¨è¶…è¶Š</h2>
<p>ç¥ä»™çš„é¢œå¤ªæˆ³æˆ‘äº†ğŸ’˜<br>
<img src="https://parallelist-c.github.io/post-images/1610674568221.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610674583782.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610674611356.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610674644738.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610674689315.jpg" alt="" loading="lazy"></p>
<h2 id="ä¸­æ£®æ˜èœ">ä¸­æ£®æ˜èœ</h2>
<p>æ˜­å’Œå¤©åï¼Œäººç¾æ­Œç”œğŸ’<br>
<img src="https://parallelist-c.github.io/post-images/1610674809954.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610674812913.jpg" alt="" loading="lazy"></p>
<h2 id="å¤§åå¯¿å¯¿èŠ±">å¤§åå¯¿å¯¿èŠ±</h2>
<p>ã€Šè‰ºå¦“å›å¿†å½•ã€‹é¢œå€¼å·…å³° çœ¼ç›çœŸçš„çµåŠ¨ã€‚<br>
<img src="https://parallelist-c.github.io/post-images/1610674956182.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610674962128.jpg" alt="" loading="lazy"><br>
<img src="https://parallelist-c.github.io/post-images/1610675408457.jpg" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HNOI2016 è§£é¢˜æŠ¥å‘Š]]></title>
        <id>https://parallelist-c.github.io/post/hnoi2016-jie-ti-bao-gao/</id>
        <link href="https://parallelist-c.github.io/post/hnoi2016-jie-ti-bao-gao/">
        </link>
        <updated>2021-01-14T11:57:27.000Z</updated>
        <content type="html"><![CDATA[<h1 id="t1-å¤§æ•°">T1 å¤§æ•°</h1>
<h2 id="description">Description</h2>
<p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„åè¿›åˆ¶æ•° <code>s</code> å’Œä¸€ä¸ªè´¨æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ã€‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡ç»™å®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mtext>Â </mtext><mi>r</mi></mrow><annotation encoding="application/x-tex">l\ r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> ï¼Œè¯¢é—®æœ‰å¤šå°‘åè¿›åˆ¶æ•° <code>s[x:y]</code> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>l</mi><mo>â‰¤</mo><mi>x</mi><mo>â‰¤</mo><mi>y</mi><mo>â‰¤</mo><mi>r</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(l\leq x\leq y\leq r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span> èƒ½è¢« <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> æ•´é™¤ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo separator="true">,</mo><mi>p</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">1\leq n,q\leq 2\times 10^5,p\leq 2\times 10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p>è®¾</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mi>s</mi><mo>[</mo><mi>j</mi><mo>]</mo><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mrow><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">h_i=\sum_{j=1}^{i}s[j]\times 10^{j-1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2254460000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8116690000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">s</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.874664em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>åˆ™åè¿›åˆ¶ä¸‹ <code>s[x:y]</code> èƒ½è¢« <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> æ•´é™¤çš„æ¡ä»¶ä¸ºï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mrow><mi>x</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mrow><mi>y</mi><mo>âˆ’</mo><mi>x</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>â‰¡</mo><msub><mi>h</mi><mi>y</mi></msub><mspace></mspace><mspace width="1em"/><mo>(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>p</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">h_{x-1}\times 10^{y-x+1}\equiv h_y\pmod{p}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.864108em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span></span></p>
<p>è½¬åŒ–ä¸€ä¸‹å°±å˜æˆäº†</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><msub><mi>h</mi><mrow><mi>x</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mrow><mn>1</mn><msup><mn>0</mn><mrow><mi>x</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow></mfrac><mo>â‰¡</mo><mfrac><msub><mi>h</mi><mi>y</mi></msub><mrow><mn>1</mn><msup><mn>0</mn><mi>y</mi></msup></mrow></mfrac><mspace></mspace><mspace width="1em"/><mo>(</mo><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mspace width="0.3333333333333333em"/><mi>p</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\frac{h_{x-1}}{10^{x-1}}\equiv \frac{h_y}{10^{y}} \pmod{p}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.590392em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:1em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.3333333333333333em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span></span></span></span></span></p>
<p>å˜æˆäº†ç»Ÿè®¡åŒºé—´å†…ç›¸ç­‰çš„æ•°çš„å¯¹æ•°ï¼Œä½¿ç”¨è«é˜Ÿå¯ä»¥åšåˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><msqrt><mi>n</mi></msqrt></mrow><annotation encoding="application/x-tex">n\sqrt{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.23972em;"></span><span class="mord mathdefault">n</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault">n</span></span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span></span></span></span> ã€‚<br>
éœ€è¦æ³¨æ„çš„æ˜¯ï¼šè¿™ä¸ª<s>å±‘</s>é¢˜æ²¡æœ‰ä¿è¯ p ä¸ 10 çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ p å¯ä»¥æ˜¯ 2 æˆ–è€… 5ã€‚æ­¤æ—¶å°±æ— æ³•ä½¿ç”¨ä¸Šè¿°åšæ³•äº†ï¼ˆ10 æ— é€†å…ƒï¼‰ï¼Œåº”è¯¥å•ç‹¬ç‰¹åˆ¤ã€‚</p>
<h2 id="code">Code</h2>
<pre><code class="language-cpp">const int N=2e5+5;
using namespace std;
int p,m;
int h[N],o[N],bel[N],inv[N],ans[N];
char s[N];
struct Query{
    int l,r,id;
    bool operator &lt;(const Query &amp;b)const{
        if(bel[l]==bel[b.l]) return r&lt;b.r;
        return l&lt;b.l;
    }
}q[N];


int Q(int b,int t){
    int ret=1;
    for(int i=1;i&lt;=t;i&lt;&lt;=1,b=1ll*b*b%p)
        if(i&amp;t) ret=1ll*ret*b%p;
    return ret;
}
namespace Sub1{
    long long now,t[N];
    void add(int v){now+=1ll*t[v],++t[v];}
    void del(int v){--t[v],now-=1ll*t[v];}
    void solve(){
        int L=1,R=0;                    // [1,L) deled [1,R] added
        for(int i=1;i&lt;=m;++i){
            --q[i].l;
            while(L&lt;q[i].l) del(h[L++]);
            while(L&gt;q[i].l) add(h[--L]);
            while(R&lt;q[i].r) add(h[++R]);
            while(R&gt;q[i].r) del(h[R--]);
            ans[q[i].id]=now;
        }
    }
}
namespace Sub2{
    bool two(char c){return (c-'0')%2==0;}
    bool fiv(char c){return (c-'0')%5==0;}
    void solve(){
        int L=1,R=0,cnt2=0,cnt5=0,now2=0,now5=0;
        for(int i=1;i&lt;=m;++i){
            while(R&lt;q[i].r){
                ++R;
                if(two(s[R])) ++cnt2,now2+=R-L+1;
                if(fiv(s[R])) ++cnt5,now5+=R-L+1;
            }
            while(R&gt;q[i].r){
                if(two(s[R])) --cnt2,now2-=R-L+1;
                if(fiv(s[R])) --cnt5,now5-=R-L+1;
                --R;
            }
            while(L&lt;q[i].l){
                now2-=cnt2,now5-=cnt5;
                if(two(s[L])) --cnt2;
                if(fiv(s[L])) --cnt5; 
                ++L;
            }
            while(L&gt;q[i].l){
                --L;
                if(two(s[L])) ++cnt2;
                if(fiv(s[L])) ++cnt5;
                now2+=cnt2,now5+=cnt5;
            }
           
            ans[q[i].id]=p==2?now2:now5;
        }
    }
}
int main(){

    scanf(&quot;%d&quot;,&amp;p);
    scanf(&quot;%s&quot;,s+1);
    int n=strlen(s+1);
    inv[0]=1;
    for(int i=1,iv=Q(10,p-2);i&lt;=n;++i)
        h[i]=(10ll*h[i-1]+s[i]-'0')%p,inv[i]=1ll*inv[i-1]*iv%p;
    for(int i=0;i&lt;=n;++i)
        h[i]=1ll*inv[i]*h[i]%p,o[i]=h[i];
    sort(o,o+n+1);
    for(int i=0;i&lt;=n;++i)
        h[i]=lower_bound(o,o+n+1,h[i])-o;
    scanf(&quot;%d&quot;,&amp;m);
    int B=sqrt(n);
    for(int i=1;i&lt;=m;++i)
        scanf(&quot;%d%d&quot;,&amp;q[i].l,&amp;q[i].r),q[i].id=i;
    for(int i=1;i&lt;=n;++i) 
        bel[i]=(i-1)/B+1;
    sort(q+1,q+m+1);
    if(p==2||p==5) Sub2::solve();
    else Sub1::solve();
    for(int i=1;i&lt;=m;++i)
        w(ans[i]);
    return 0;
}
</code></pre>
<h1 id="t2-åºåˆ—">T2 åºåˆ—</h1>
<h2 id="description-2">Description</h2>
<p>ç»™å®šé•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„åºåˆ— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>{</mo><mi>a</mi><mo>}</mo></mrow><annotation encoding="application/x-tex">\{a\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">a</span><span class="mclose">}</span></span></span></span> ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡ç»™å®šä¸¤ä¸ªæ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mtext>Â </mtext><mi>r</mi></mrow><annotation encoding="application/x-tex">l\ r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> ï¼Œæ±‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>[</mo><mi>l</mi><mo>:</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">a[l:r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> çš„æ‰€æœ‰å­ä¸²çš„æœ€å°å€¼ä¹‹å’Œã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">1\leq n,q\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-2">Solution</h2>
<p>è¿™ä¸ªé¢˜ä¹Ÿç®—æ˜¯ä¸€ä¸ª trick å§ã€‚<br>
è®¾ <code>f[p]</code> è¡¨ç¤ºä»¥ p ä¸ºå³ç«¯ç‚¹ï¼Œå·¦ç«¯ç‚¹ä½äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ¼</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">1\sim p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ä¹‹é—´çš„æ‰€æœ‰å­ä¸²çš„æœ€å°å€¼ä¹‹å’Œã€‚å³ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>p</mi></munderover><mi>min</mi><mo>â¡</mo><mo>{</mo><msub><mi>a</mi><mi>i</mi></msub><mo separator="true">,</mo><mo>â‹¯</mo><mtext>â€‰</mtext><mo separator="true">,</mo><msub><mi>a</mi><mi>p</mi></msub><mo>}</mo></mrow><annotation encoding="application/x-tex"> f[p]=\sum\limits_{i=1}^{p}\min\{a_i,\cdots,a_p\}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.9761740000000003em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985050000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.347113em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯ä¸å…·æœ‰é€šå¸¸æ„ä¹‰ä¸Šçš„å¯å·®åˆ†æ€§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>f[r]-f[l-1]</code> æ˜¯æ— æ„ä¹‰çš„ã€‚<br>
ä½†æ˜¯æˆ‘ä»¬æœ‰åŠæ³•è®©å®ƒå¯ä»¥å·®åˆ†ã€‚è€ƒè™‘ <code>f[p]</code> çš„é€’æ¨å¼ã€‚è®¾ <code>pre[p]</code> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ä¹‹å‰çš„ç¬¬ä¸€ä¸ªæ¯”å®ƒå°çš„ä½ç½®ï¼ˆè‹¥å‡æ¯”å®ƒå¤§åˆ™è®¾ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> ï¼‰ã€‚é‚£ä¹ˆæœ‰</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><mi>f</mi><mo>[</mo><msub><mtext>pre</mtext><mi>p</mi></msub><mo>]</mo><mo>+</mo><mi>a</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>âˆ—</mo><mo>(</mo><mi>p</mi><mo>âˆ’</mo><msub><mtext>pre</mtext><mi>p</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">f[p]=f[\text{pre}_p]+a[p]*(p-\text{pre}_p)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.130248em;vertical-align:-0.380248em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord"><span class="mord text"><span class="mord">pre</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252000000000025em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.380248em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.130248em;vertical-align:-0.380248em;"></span><span class="mord"><span class="mord text"><span class="mord">pre</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252000000000025em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.380248em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>æ‰€ä»¥ <code>f[p]-f[pre[p]]</code> æ˜¯å…·æœ‰å¯å·®åˆ†æ€§çš„ï¼Œå®ƒçš„å«ä¹‰æ˜¯å³ç«¯ç‚¹åœ¨ p ï¼Œå·¦ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>pre</mtext><mi>p</mi></msub><mo>+</mo><mn>1</mn><mo>âˆ¼</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">\text{pre}_p+1\sim p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.963578em;vertical-align:-0.380248em;"></span><span class="mord"><span class="mord text"><span class="mord">pre</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252000000000025em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.380248em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> çš„æ‰€æœ‰å­ä¸²çš„æœ€å°å€¼ä¹‹å’Œã€‚<br>
æ—¢ç„¶ <code>f[p]-f[pre[p]]</code> å¯å·®åˆ†ï¼Œé‚£ä¹ˆ <code>f[pre[p]]-f[pre[pre[p]]]</code> ä¹Ÿå…·æœ‰å¯å·®åˆ†æ€§......<br>
é‡è¦å‘ç°ï¼šæˆ‘ä»¬æ‰¾åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> ä¸­çš„æœ€å°å€¼ä½ç½® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ï¼Œé‚£ä¹ˆ <code>f[r]-f[x]</code> çš„å«ä¹‰æ˜¯å³ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> ï¼Œå·¦ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>+</mo><mn>1</mn><mo>âˆ¼</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">x+1\sim r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> çš„æ‰€æœ‰å­ä¸²çš„æœ€å°å€¼ä¹‹å’Œã€‚<br>
ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> æ˜¯åŒºé—´æœ€å°å€¼ä½ç½®ï¼Œæ‰€ä»¥ä¸€ç›´èµ° <code>pre</code> ä¸€å®šå¯ä»¥èµ°åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬ä¸å¦¨å…ˆè€ƒè™‘å·¦ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ä»¥å³çš„æ‰€æœ‰åŒºé—´çš„è´¡çŒ®ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mi>x</mi><mo>+</mo><mn>1</mn></mrow><mi>r</mi></munderover><mo>(</mo><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>âˆ’</mo><mi>f</mi><mo>[</mo><mi>x</mi><mo>]</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\sum_{i=x+1}^{r}(f[i]-f[x])
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.9873970000000005em;vertical-align:-1.336em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.8723309999999997em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mathdefault mtight">x</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.336em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span><span class="mclose">)</span></span></span></span></span></p>
<p>è¿™å¼å­æ˜æ˜¾å¯ä»¥å‰ç¼€å’Œä¼˜åŒ–ã€‚è®¾ <code>g[p]</code> æ˜¯ <code>f</code> çš„å‰ç¼€å’Œï¼Œå¯å¾—ä¸Šå¼ä¸ºï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>r</mi><mo>]</mo><mo>âˆ’</mo><mi>g</mi><mo>[</mo><mi>x</mi><mo>]</mo><mo>âˆ’</mo><mo>(</mo><mi>r</mi><mo>âˆ’</mo><mi>x</mi><mo>)</mo><mo>âˆ—</mo><mi>f</mi><mo>[</mo><mi>x</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">g[r]-g[x]-(r-x)*f[x]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span></span></span></span></span></p>
<p>äºæ˜¯è¿™ä¸ªè´¡çŒ®å°±å¯ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> è®¡ç®—å‡ºæ¥ã€‚<br>
å³ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ä»¥å·¦çš„åŒºé—´å¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹æ³•è®¡ç®—ï¼Œä¸èµ˜è¿°ã€‚<br>
å‰©ä¸‹çš„å³ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ä»¥å³ï¼Œå·¦ç«¯ç‚¹åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ä»¥å·¦çš„åŒºé—´çš„è´¡çŒ®å°±æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>r</mi><mo>âˆ’</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>âˆ—</mo><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>âˆ—</mo><mi>a</mi><mo>[</mo><mi>x</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">(r-x+1)*(x-l+1)*a[x]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault">x</span><span class="mclose">]</span></span></span></span> ã€‚<br>
äºæ˜¯å°±å¯ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> å›ç­”æ¯ä¸ªè¯¢é—®äº†ã€‚</p>
<p>å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>+</mo><mi>q</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log_2n+q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span></span></span></span>ã€‚</p>
<h2 id="code-2">Code</h2>
<pre><code class="language-cpp">const int N=1e5+5;
using namespace std;
int n,m;
int s[N],lg[N],suf[N],pre[N],f[N][20];
long long a[N],gl[N],gr[N],fl[N],fr[N];
int check(int x,int y){return a[x]&lt;a[y]?x:y;}
int query(int x,int y){
   int k=lg[y-x+1];
   return check(f[x][k],f[y-(1&lt;&lt;k)+1][k]);
}
int main(){

   r(n,m);
   for(int i=1;i&lt;=n;++i) r(a[i]),f[i][0]=i;
   for(int i=2;i&lt;=n;++i) lg[i]=lg[i&gt;&gt;1]+1;
   for(int j=1;j&lt;=lg[n];++j)
   for(int i=1;i+(1&lt;&lt;j)-1&lt;=n;++i)
       f[i][j]=check(f[i][j-1],f[i+(1&lt;&lt;j-1)][j-1]);
   int top=0;
   for(int i=1;i&lt;=n;++i){
       while(top&amp;&amp;a[s[top]]&gt;=a[i]) suf[s[top]]=i,--top;
       pre[i]=s[top],s[++top]=i;
   }
   while(top) 
       pre[s[top]]=s[top-1],suf[s[top]]=n+1,--top;
   for(int i=1;i&lt;=n;++i) fl[i]=fl[pre[i]]+1ll*a[i]*(i-pre[i]),gl[i]=gl[i-1]+fl[i];
   for(int i=n;i&gt;=1;--i) fr[i]=fr[suf[i]]+1ll*a[i]*(suf[i]-i),gr[i]=gr[i+1]+fr[i];
   for(int i=1,x,y;i&lt;=m;++i){
       r(x,y);int pos=query(x,y);
       long long ans=1ll*(pos-x+1)*(y-pos+1)*a[pos];
       ans=ans+(gl[y]-gl[pos]-1ll*fl[pos]*(y-pos));
       ans=ans+(gr[x]-gr[pos]-1ll*fr[pos]*(pos-x));
       w(ans);
   }
   return 0;
}
</code></pre>
<h1 id="t3-ç½‘ç»œ">T3 ç½‘ç»œ</h1>
<h2 id="description-3">Description</h2>
<p>ç»™å®šä¸€æ£µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹çš„æ ‘ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¬¡æ“ä½œï¼Œåˆ†åˆ«ä¸ºä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>åŠ å…¥è·¯å¾„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo>â†’</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">u\rightarrow v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ï¼Œè·¯å¾„é‡è¦åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ã€‚</li>
<li>æ’¤é”€ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> æ¬¡æ“ä½œæ—¶åŠ å…¥çš„è·¯å¾„ã€‚</li>
<li>è¯¢é—®æ‰€æœ‰ä¸ç»è¿‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> çš„è·¯å¾„ä¸­é‡è¦åº¦çš„æœ€å¤§å€¼ã€‚è‹¥æœªç»è¿‡è·¯å¾„ï¼Œè¾“å‡º <code>-1</code> ã€‚</li>
</ul>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n,m\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-3">Solution</h2>
<p>æ•´ä½“äºŒåˆ†ï¼Œä»…åœ¨é‡è¦åº¦å¤§äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> çš„è·¯å¾„ä¸Šä¿®æ”¹ï¼ˆåŒ…å«åŠ å…¥/æ’¤é”€ï¼‰ã€‚è¯¢é—®æ—¶ç»Ÿè®¡ç›®å‰ç»è¿‡è¯¥ç‚¹çš„è·¯å¾„æ€»æ•°ï¼Œå¹¶ä¸å½“å‰åŠ å…¥çš„è·¯å¾„æ€»æ¡æ•°è¿›è¡Œæ¯”è¾ƒå†å†³å®šæ˜¯å·¦é€’å½’è¿˜æ˜¯å³é€’å½’ã€‚<br>
é—®é¢˜è½¬åŒ–ä¸ºè·¯å¾„è¦†ç›–å’Œå•ç‚¹æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡æ ‘ä¸Šå·®åˆ†å†æ¬¡è½¬åŒ–ä¸ºå•ç‚¹ä¿®æ”¹å­æ ‘æŸ¥è¯¢ã€‚ä½¿ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>m</mi><msubsup><mi>log</mi><mo>â¡</mo><mn>2</mn><mn>2</mn></msubsup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m\log^2_2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>m</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m\log_2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> çš„çº¿æ®µæ ‘äºŒåˆ†åšæ³•ã€‚<br>
å…ˆå°†è·¯å¾„æ’åºï¼Œå¹¶å»ºç«‹ä¸€æ£µçº¿æ®µæ ‘ï¼Œå¶å­èŠ‚ç‚¹ç»´æŠ¤æ’åºåçš„è·¯å¾„ï¼ˆä¹Ÿå°±æ˜¯å¶å­ç»“ç‚¹çš„æƒå€¼å•è°ƒï¼‰ã€‚æ™®é€šçš„èŠ‚ç‚¹å°±ç»´æŠ¤ä¸¤ä¸ªå­èŠ‚ç‚¹çš„è·¯å¾„çš„è·¯å¾„äº¤ã€‚å†æŒ‰ç…§æ—¶é—´é¡ºåºæ’å…¥/æ’¤é”€/æŸ¥è¯¢å³å¯ã€‚</p>
<p>åšä¸»æœ¬äººæƒ³è®­ç»ƒæ•´ä½“äºŒåˆ†ï¼Œæ•…ä»£ç é‡‡ç”¨çš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p>
<h2 id="code-3">Code</h2>
<pre><code class="language-cpp">const int N=2e5+5;
using namespace std;
int n,m,dfn,num;
int in[N],out[N],dep[N],f[N][20];
int o[N],head[N],nt[N&lt;&lt;1],to[N&lt;&lt;1];
struct Query{
    int tp,a,b,v,val,id,ans;
    Query(int id=0,int tp=0,int a=0,int b=0,int v=0,int val=0):
        id(id),tp(tp),a(a),b(b),v(v),val(val) {}
    bool operator &lt;(const Query &amp;o)const{
        return id&lt;o.id;
    }
}q[N],Qt[N];
void Add(int x,int y){
    ++num;nt[num]=head[x];head[x]=num;to[num]=y;
    ++num;nt[num]=head[y];head[y]=num;to[num]=x;
}
int LCA(int x,int y){
    if(dep[x]&lt;dep[y]) x^=y^=x^=y;
    for(int i=19;i&gt;=0;--i)
        if(dep[f[x][i]]&gt;=dep[y]) x=f[x][i];
    if(x==y) return x;
    for(int i=19;i&gt;=0;--i)
        if(f[x][i]!=f[y][i]) x=f[x][i],y=f[y][i];
    return f[x][0];
}
namespace BIT{
#define lowb(x) (x&amp;-x)
    int t[N]; //various
    void Add(register int p,int v){
        while(p&lt;=n) t[p]+=v,p+=lowb(p);
    }
    int Get(register int p){
        int ret=0;
        while(p) ret+=t[p],p-=lowb(p);
        return ret;
    }
    void modify(int x,int y,int v){
        int z=LCA(x,y);Add(in[x],v),Add(in[y],v),Add(in[z],-v);
        if(f[z][0]) Add(in[f[z][0]],-v);
    }
    int query(int x){
        return Get(out[x])-Get(in[x]-1);
    }
#undef lowb
}
using BIT::modify;
using BIT::query;
void solve(int QL,int QR,int VL,int VR){
    if(QL&gt;QR) return;
    if(VL==VR){
        for(int i=QL;i&lt;=QR;++i) 
            if(q[i].tp==2) q[i].ans=o[VL];
        return;
    }
    int mid=VL+VR&gt;&gt;1,path=0,tl=QL,tr=QR;
    for(int i=QL;i&lt;=QR;++i)
        if(q[i].tp&lt;2)
            if(q[i].v&lt;=o[mid]) Qt[tl++]=q[i];
            else modify(q[i].a,q[i].b,q[i].val),Qt[tr--]=q[i],path+=q[i].val;
        else{
            //if(QL==1&amp;&amp;QR==23) cerr&lt;&lt;q[i].a&lt;&lt;&quot; &quot;&lt;&lt;query(q[i].a)&lt;&lt;endl;
            if(query(q[i].a)==path) Qt[tl++]=q[i];
            else Qt[tr--]=q[i];
        }
    for(int i=tr+1;i&lt;=QR;++i)
        if(Qt[i].tp&lt;2) modify(Qt[i].a,Qt[i].b,-Qt[i].val);
    for(int i=QL;i&lt;tl;++i) q[i]=Qt[i];
    reverse(Qt+tr+1,Qt+QR+1);
    for(int i=QR;i&gt;tr;--i) q[i]=Qt[i];
    solve(QL,tl-1,VL,mid);solve(tr+1,QR,mid+1,VR);
}
void dfs(int p,int fa){
    f[p][0]=fa;dep[p]=dep[fa]+1;in[p]=++dfn;
    for(int i=0;f[p][i];++i) f[p][i+1]=f[f[p][i]][i];
    for(int i=head[p];i;i=nt[i])
        if(to[i]^fa) dfs(to[i],p);
    out[p]=dfn;
}
int main(){

    r(n,m);
    for(int i=1,x,y;i&lt;n;++i)
        r(x,y),Add(x,y);
    dfs(1,0);
    int cnt=0;
    for(int i=1,type;i&lt;=m;++i){
        r(type);int a,b,v,t;
        if(type==0) r(a,b,v),q[i]=Query(i,type,a,b,v,1),o[++cnt]=v;
        if(type==1) r(t),q[i]=q[t],q[i].val=-1,q[i].id=i,q[i].tp=type;
        if(type==2) r(a),q[i]=Query(i,type,a);
    }
    o[++cnt]=-1;
    sort(o+1,o+cnt+1);
    solve(1,m,1,cnt);
    sort(q+1,q+m+1);
    for(int i=1;i&lt;=m;++i)
        if(q[i].tp==2) w(q[i].ans);
    return 0;
}
</code></pre>
<h1 id="t4-æœ€å°å…¬å€æ•°">T4 æœ€å°å…¬å€æ•°</h1>
<h2 id="description-4">Description</h2>
<p>ç»™å®šä¸€å¼  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¡è¾¹çš„å›¾ï¼Œæ¯æ¡è¾¹ä¸Šæœ‰ä¸¤ä¸ªå±æ€§ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>e</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">e_a,e_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®èƒ½å¦æ‰¾åˆ°ä¸€æ¡ä» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> çš„è·¯å¾„ï¼Œæ»¡è¶³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>max</mi><mo>â¡</mo><mo>{</mo><msub><mi>e</mi><mi>a</mi></msub><mo>}</mo><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">\max\{e_a\}=a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>max</mi><mo>â¡</mo><mo>{</mo><msub><mi>e</mi><mi>b</mi></msub><mo>}</mo><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">\max\{e_b\}=b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> ã€‚è·¯å¾„ä¸è¦æ±‚æ˜¯ç®€å•è·¯å¾„ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>5</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup><mo separator="true">,</mo><mi>m</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n,q\leq 5\times 10^4,m\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-4">Solution</h2>
<p>æ®è¯´æ˜¯ä¸ªè›®ç»å…¸çš„ trick ã€‚<br>
å¦‚æœåªæœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>max</mi><mo>â¡</mo><mo>{</mo><msub><mi>e</mi><mi>a</mi></msub><mo>}</mo><mo>=</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">\max\{e_a\}=a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> è¿™ä¸ªè¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å‡åºä¾æ¬¡åŠ è¾¹ï¼Œé€šè¿‡å¹¶æŸ¥é›†ç»´æŠ¤ä¸¤ç‚¹è¿é€šæ€§ä»¥åŠè¿é€šå—å†…æœ€å¤§ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">e_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å€¼ã€‚ç¦»çº¿è¯¢é—®å³å¯å¿«é€Ÿå¤„ç†ã€‚<br>
ä½†æ˜¯ç°åœ¨æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>å¯¹äºè¿™ç§æœ‰ä¸¤ä¸ªé™åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†å—æ¥å¤„ç†ã€‚<br>
é¦–å…ˆæŒ‰ç…§ç¬¬ä¸€å…³é”®å­—ï¼ˆè¿™é‡Œé€‰æ‹© <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">e_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼‰æ’åºååˆ†å—ï¼Œå¹¶å°†è¯¢é—®æŒ‚åˆ°å—ä¸Šã€‚å¯¹äºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸ªè¯¢é—®ï¼Œæˆ‘ä»¬æŠŠå®ƒæŒ‚åˆ°ç¬¬ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">e_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å¤§äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„ç‚¹å¯¹åº”çš„å—ä¸Šã€‚æ‰€ä»¥å¯¹äºä¸€ä¸ªè¯¢é—®è€Œè¨€ï¼Œå…¶å¯¹åº”çš„å—çš„æ‰€æœ‰å‰ç¼€çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">e_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> éƒ½æ˜¯æ»¡è¶³æ¡ä»¶çš„ã€‚å½“å¤„ç†åˆ°ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªå—æ—¶ï¼Œå°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ¼</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1\sim k-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> çš„å—å†…çš„å…ƒç´ æŒ‰ç…§ç¬¬äºŒå…³é”®å­—ï¼ˆè¿™é‡Œé€‰æ‹© <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>e</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">e_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">b</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼‰æ’åºï¼Œå¹¶å°†æŒ‚åœ¨è¿™ä¸ªå—ä¸Šçš„æ‰€æœ‰è¯¢é—®æŒ‰ç…§ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ’åºã€‚è¿™æ ·å¯¹äºå—å¤–çš„å…ƒç´ æˆ‘ä»¬å¯ä»¥åŒæŒ‡é’ˆæ·»åŠ ï¼ˆå› ä¸ºç¬¬ä¸€å…³é”®å­—å·²ç»æ»¡è¶³æ¡ä»¶äº†ï¼‰ï¼Œå¯¹äºå—å†…çš„å…ƒç´ ï¼ˆæœ‰çš„ç¬¬ä¸€å…³é”®å­—è¿˜æœªæ»¡è¶³æ¡ä»¶ï¼‰æš´åŠ›æ·»åŠ /æ’¤é”€ã€‚æ°å¥½æˆ‘ä»¬çš„å¹¶æŸ¥é›†æ˜¯å¯ä»¥æ”¯æŒæ’¤é”€æ“ä½œçš„ã€‚äºæ˜¯é—®é¢˜é¡ºåˆ©è§£å†³ã€‚</p>
<p>å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mo>(</mo><mi>q</mi><mo>+</mo><mi>m</mi><mo>)</mo><msqrt><mi>m</mi></msqrt><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>m</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}((q+m)\sqrt{m}\log_2{m})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mclose">)</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault">m</span></span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">m</span></span><span class="mclose">)</span></span></span></span> ã€‚å¥½åƒæœ‰ç‚¹çˆ†ç‚¸ï¼Œä½†åº”è¯¥æ˜¯è·‘ä¸æ»¡çš„ã€‚</p>
<h2 id="code-4">Code</h2>
<pre><code class="language-cpp">const int N=5e4+5,M=1e5+5;
using namespace std;
int n,m,Q;
struct edge{
    int u,v,a,b,id;
    edge(int u=0,int v=0,int a=0,int b=0,int id=0):
        u(u),v(v),a(a),b(b),id(id) {}  
}e[M];
vector&lt;edge&gt;q[M];
namespace Union{
    int top;
    int f[N],sz[N],mxa[N],mxb[N];
    edge draw[M];
    void Init(){
        for(int i=1;i&lt;=n;++i)
            f[i]=i,mxa[i]=mxb[i]=-1,sz[i]=1;
    }
    int Find(int x) {return f[x]==x?x:Find(f[x]);}
    void Link(int u,int v,int a,int b,int tp){
        u=Find(u),v=Find(v);
        if(u==v){
            if(tp) draw[++top]=edge(u,0,mxa[u],mxb[u]);
            mxa[u]=max(mxa[u],a);
            mxb[u]=max(mxb[u],b);
            return;
        }
        if(sz[u]&lt;sz[v]) swap(u,v); 
        if(tp) draw[++top]=edge(u,v,mxa[u],mxb[u]);
        sz[u]+=sz[v];f[v]=u;
        mxa[u]=max(mxa[u],max(mxa[v],a));
        mxb[u]=max(mxb[u],max(mxb[v],b));
    }
    void Back(){
        for(;top;--top){
            edge t=draw[top];
            if(t.v==0){
                mxa[t.u]=t.a;mxb[t.u]=t.b;
                continue;
            }
            sz[t.u]-=sz[t.v];f[t.v]=t.v;
            mxa[t.u]=t.a,mxb[t.u]=t.b;
        }
    }
}
using namespace Union;
bool cmpa(edge x,edge y){return x.a&lt;y.a;}
bool cmpb(edge x,edge y){return x.b&lt;y.b;}
int Min[M],ans[N];
int main(){

    r(n,m);
    for(int i=1,u,v,a,b;i&lt;=m;++i)
        r(u,v,a,b),e[i]=edge(u,v,a,b,i);
    sort(e+1,e+m+1,cmpa); 
    int B=400;
    for(int i=1,id=1;i&lt;=m;i+=B,++id){
        int up=min(i+B-1,m);
        Min[id+1]=0x3f3f3f3f;
        Min[id]=e[i].a;
    }
    r(Q);
    for(int i=1,u,v,a,b;i&lt;=Q;++i){
        r(u,v,a,b);
        for(int id=2;;++id)
            if(Min[id]&gt;a) {q[id-1].push_back(edge(u,v,a,b,i));break;}
    }
    for(int i=1,id=1;i&lt;=m;i+=B,++id){
        if(!q[id].size()) continue;
        Init();
        int up=min(i+B-1,m);
        sort(q[id].begin(),q[id].end(),cmpb);
        sort(e+1,e+i,cmpb);
        int cnt=1;
        for(auto now:q[id]){
            while(cnt&lt;i&amp;&amp;e[cnt].b&lt;=now.b)
                Link(e[cnt].u,e[cnt].v,e[cnt].a,e[cnt].b,0),++cnt;
            for(int j=i;j&lt;=up;++j)
                if(e[j].a&lt;=now.a&amp;&amp;e[j].b&lt;=now.b)
                    Link(e[j].u,e[j].v,e[j].a,e[j].b,1);
            int u=Find(now.u),v=Find(now.v);
            ans[now.id]=(u==v)&amp;&amp;(mxa[u]==now.a)&amp;&amp;(mxb[u]==now.b);
            Back();
        }
    }
    for(int i=1;i&lt;=Q;++i)
        puts(ans[i]?&quot;Yes&quot;:&quot;No&quot;);
    return 0;
}
</code></pre>
<h1 id="t5-çŸ¿åŒº">T5 çŸ¿åŒº</h1>
<h2 id="description-5">Description</h2>
<p>ç»™å®šä¸€å¼  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¡è¾¹çš„å¹³é¢å›¾ï¼Œå¹³é¢å›¾ä¸Šæœ‰è‹¥å¹²ä¸ªå¹³é¢å—ï¼Œæ¯ä¸ªå—çš„çŸ¿é‡æ˜¯é¢ç§¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> çš„å¹³æ–¹ã€‚ç°åœ¨æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> ä¸ªå¼€é‡‡è®¡åˆ’ï¼Œæ¯ä¸ªå¼€é‡‡è®¡åˆ’ä¼šé€†æ—¶é’ˆç»™å®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span> ä¸ªç‚¹ï¼Œè¡¨ç¤ºè¯¢é—®è¿™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span> ä¸ªç‚¹å›´æˆçš„å°é—­å›¾å½¢ä¸­å¹³é¢å—çš„çŸ¿é‡ä¹‹å’Œä¸å¹³é¢å—çš„é¢ç§¯ä¹‹å’Œçš„æ¯”å€¼ã€‚è¦æ±‚ç»™å‡ºæœ€ç®€åˆ†æ•°å½¢å¼ã€‚</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo separator="true">,</mo><mi>m</mi><mo>â‰¤</mo><mn>3</mn><mi>n</mi><mo>âˆ’</mo><mn>6</mn><mo separator="true">,</mo><mo>âˆ‘</mo><mi>c</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">n,q\leq 2\times 10^5,m\leq 3n-6,\sum c\leq 2\times 10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mord">6</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span> ã€‚ç‚¹çš„åæ ‡æ˜¯æ•´æ•°ã€‚æ— å¤šä½™çš„è¾¹ã€‚ä¿è¯æ¯æ¬¡æŸ¥è¯¢çš„åŒºåŸŸè‡³å°‘åŒ…å«ä¸€ä¸ªå¹³é¢å—ï¼Œä¸”å¹³é¢å—ä¸€å®šè¿é€šã€‚ä¿è¯ç­”æ¡ˆä¸å¤§äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mn>63</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{63}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ã€‚</p>
<h2 id="solution-5">Solution</h2>
<p>æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯æ˜¯å¹³é¢å›¾è½¬å¯¹å¶å›¾ã€‚æŠŠå¹³é¢å›¾ä¸Šçš„æ¯ä¸ªé¢è½¬ä¸ºç‚¹ï¼Œç‚¹æƒä¸ºé¢ç§¯ã€‚ç„¶åæ„é€ å‡ºåŸå›¾çš„ä»»æ„ä¸€æ£µç”Ÿæˆæ ‘ï¼ˆä»¥æ— ç©·åŸŸä¸ºæ ¹ï¼‰ï¼Œç„¶ååœ¨ç”Ÿæˆæ ‘ä¸Šè®¡ç®—ç­”æ¡ˆã€‚<br>
æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è½¬å¯¹å¶å›¾ã€å¦‚ä½•æ‰¾ç”Ÿæˆæ ‘ã€å¦‚ä½•è®¡ç®—ç­”æ¡ˆäº†ã€‚æ–¹æ³•å¤§æˆ˜ã€‚<br>
é¦–å…ˆæ˜¯å¦‚ä½•è½¬å¯¹å¶å›¾ã€‚å°†æ¯æ¡è¾¹æ‹†ä¸ºä¸¤æ¡å•å‘è¾¹ï¼Œè¿™æ ·æ¯æ¡è¾¹éƒ½å±äºä¸€ä¸ªé¢ï¼ˆæœ€å¤–å±‚çš„è¾¹å±äºæ— ç©·åŸŸé¢ï¼‰ã€‚å°†è¾¹æŒ‚åœ¨ç‚¹ä¸Šï¼Œå¹¶å°†ç‚¹ä¸Šçš„è¾¹æè§’æ’åºã€‚å½“æ‰¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo>â†’</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">u\rightarrow v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ä¸å“ªäº›è¾¹å±äºä¸€ä¸ªé¢æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ä¸ºèµ·ç‚¹çš„è¾¹ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi><mo>â†’</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">v\rightarrow u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> çš„å‰é©±å³å¯ã€‚è®°å½• <code>nxt[p]</code> è¡¨ç¤ºé€†æ—¶é’ˆæ–¹å‘ä¸Š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> è¿™æ¡è¾¹æ‰€åœ¨çš„é¢çš„åä¸€æ¡è¾¹ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªå‰é©±å°±æ˜¯ <code>nxt</code> ã€‚<br>
ç„¶åæ˜¯å¦‚ä½•æ‰¾ç”Ÿæˆæ ‘ã€‚å…ˆç»™æ¯ä¸ªé¢è®¡ç®—é¢ç§¯ï¼Œé™¤äº†æ— ç©·åŸŸå¤–ï¼Œé¢ç§¯å‡ä¸ºæ­£æ•°ã€‚æˆ‘ä»¬å°†æ— ç©·åŸŸè®¾ä¸ºæ ¹ã€‚ç›¸é‚»ä¸¤ä¸ªé¢åœ¨å¯¹å¶å›¾ä¸­ç›¸è¿å½“ä¸”ä»…å½“å…±è¾¹ã€‚äºæ˜¯æšä¸¾åŸå›¾ä¸­çš„æ¯æ¡è¾¹ï¼Œå°†æ­£åè¾¹æ‰€å±çš„é¢ç›¸è¿å³å¯ã€‚<br>
æœ€åæ˜¯å¦‚ä½•è®¡ç®—ç­”æ¡ˆã€‚é€ æˆç­”æ¡ˆçš„ä¸€å®šæ˜¯ä¸€ä¸ªç‚¹é›†ï¼Œç‚¹é›†çš„è´¡çŒ®å¯ä»¥ç”±å­æ ‘ä¹‹é—´åŠ åŠ å‡å‡æ¥æ±‚å¾—ã€‚æ•…é¦–å…ˆåœ¨ç”Ÿæˆæ ‘ä¸Šåšå­æ ‘å’Œã€‚å¯¹äºç»™å®šçš„è¾¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo>â†’</mo><mi>v</mi></mrow><annotation encoding="application/x-tex">u\rightarrow v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ï¼Œå¦‚æœæ˜¯éæ ‘è¾¹ç›´æ¥å¿½ç•¥ï¼›å¦‚æœè¿™æ¡è¾¹æ‰€åœ¨çš„é¢æ˜¯åè¾¹çš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥åŠ ä¸Šè¿™ä¸ªç‚¹çš„ç­”æ¡ˆï¼›å¦åˆ™ï¼Œæˆ‘ä»¬å°±å‡å»è¿™ä¸ªç‚¹çš„åè¾¹çš„é¢çš„ç­”æ¡ˆã€‚è¿™éƒ¨åˆ†å¯èƒ½æœ‰äº›æŠ½è±¡ï¼Œä½†ç”»ä¸ªå›¾å°±å¾ˆå¥½ç†è§£ã€‚</p>
<p>å¤æ‚åº¦å¤§æ¦‚æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mo>(</mo><mi>m</mi><mo>+</mo><mi>q</mi><mo>)</mo><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>m</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}((m+q)\log_2m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mclose">)</span></span></span></span> çš„å§ã€‚</p>
<h2 id="code-5">Code</h2>
<pre><code class="language-cpp">const int N=2e5+5,M=12e5+5;
using namespace std;
int n,m,Q,rt,cnt,num,tot=1;
int f[M&lt;&lt;1],nxt[M&lt;&lt;1],pos[M&lt;&lt;1],vis[M&lt;&lt;1],intr[M&lt;&lt;1];
long long s[M&lt;&lt;1],fz[M&lt;&lt;1],fm[M&lt;&lt;1];
struct vec{
    int x,y;
    vec(int x=0,int y=0):x(x),y(y) {}
    vec operator -(const vec &amp;b)const{return vec(x-b.x,y-b.y);}
}p[N];
long long crs(vec a,vec b){return 1ll*a.x*b.y-1ll*a.y*b.x;}
const double eps=1e-9;
int dcmp(double v){
    return fabs(v)&lt;eps?0:1;
}
struct edge{
    int id,u,v;double d;
    edge(int id=0,int u=0,int v=0,double d=0):
        id(id),u(u),v(v),d(d) {}
    bool operator &lt;(const edge &amp;b)const{
        return dcmp(b.d-d)==0?v&lt;b.v:d&lt;b.d;
    }
}l[M&lt;&lt;1];
vector&lt;edge&gt;line[N];
void add(int a,int b){
    ++tot;l[tot]=edge(tot,a,b,atan2((p[b]-p[a]).y,(p[b]-p[a]).x));line[a].push_back(l[tot]);
}
int nt[M&lt;&lt;2],to[M&lt;&lt;2],val[M&lt;&lt;2],head[M&lt;&lt;1];
void Add(int x,int y,int z){
    ++num;nt[num]=head[x];head[x]=num;to[num]=y;val[num]=z;
    ++num;nt[num]=head[y];head[y]=num;to[num]=x;val[num]=z;
}
void build(){
    for(int i=1;i&lt;=n;++i) sort(line[i].begin(),line[i].end());
    for(int i=2;i&lt;=tot;++i){
        int a=l[i].v;
        vector&lt;edge&gt;::iterator p=lower_bound(line[a].begin(),line[a].end(),l[i^1]);
        if(p==line[a].begin()) p=line[a].end();
        nxt[i]=(*(--p)).id;
    }
    for(int i=2;i&lt;=tot;++i){
        if(pos[i]) continue;
        pos[i]=pos[nxt[i]]=++cnt;
        for(int j=nxt[i];l[j].v!=l[i].u;pos[j=nxt[j]]=cnt)
            s[cnt]+=crs((p[l[j].u]-p[l[i].u]),(p[l[j].v]-p[l[i].u]));
        if(s[cnt]&lt;=0) rt=cnt;
    }
    for(int i=2;i&lt;=tot;++i)
        Add(pos[i],pos[i^1],i);
}
void dfs(int p,int fa){
    f[p]=fa,fz[p]=1ll*s[p]*s[p],fm[p]=s[p]*2;vis[p]=1;
    for(int i=head[p];i;i=nt[i])if(!vis[to[i]]){
        int v=to[i];dfs(v,p);
        fm[p]+=fm[v];fz[p]+=fz[v];
        intr[val[i]]=intr[val[i]^1]=1;
    }
}
int q[N*10];
long long GCD(long long a,long long b){
    return !b?a:GCD(b,a%b);
}
int main(){

    r(n,m,Q);
    for(int i=1,x,y;i&lt;=n;++i) 
        r(x,y),p[i]=vec(x,y);
    for(int i=1,x,y;i&lt;=m;++i)
        r(x,y),add(x,y),add(y,x);
    build();dfs(rt,0);
    long long ans1=0,ans2=0,c=0;
    for(int i=1;i&lt;=Q;++i){
        r(c);c=(c+ans1)%n+1;
        for(int j=1,x;j&lt;=c;++j) r(x),q[j]=(x+ans1)%n+1;
        q[c+1]=q[1],ans1=ans2=0;
        for(int j=1,x,y;j&lt;=c;++j){
            x=q[j],y=q[j+1];
            edge now=edge(0,x,y,atan2((p[y]-p[x]).y,(p[y]-p[x]).x));
            auto p=lower_bound(line[x].begin(),line[x].end(),now);
            int id=(*p).id;
            if(!intr[id]) continue;
            if(f[pos[id]]==pos[id^1]) ans1+=fz[pos[id]],ans2+=fm[pos[id]];
            else ans1-=fz[pos[id^1]],ans2-=fm[pos[id^1]];
        }
        long long gcd=GCD(ans1,ans2);
        ans1/=gcd,ans2/=gcd;
        w(ans1,' '),w(ans2);
    }
    return 0;
}
</code></pre>
<h1 id="t6-æ ‘">T6 æ ‘</h1>
<h2 id="description-6">Description</h2>
<p>å° A æƒ³åšä¸€æ£µå¤§æ ‘ã€‚ä¸€å¼€å§‹æ—¶ï¼Œå° A åªæœ‰ä¸€æ£µèŠ‚ç‚¹æ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„ä»¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ä¸ºæ ¹æ¨¡æ¿æ ‘ã€‚å° A å†³å®šç”¨æ¨¡æ¿æ ‘æ¥æ„å»ºä¸€æ£µå¤§æ ‘ã€‚æ„å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š<br>
1ã€å°†æ¨¡æ¿æ ‘å¤åˆ¶ä¸ºåˆå§‹çš„å¤§æ ‘ã€‚<br>
2ã€ ä»¥ä¸‹(2.1)(2.2)(2.3)æ­¥å¾ªç¯æ‰§è¡Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¬¡<br>
ï¼ˆ2.1ï¼‰é€‰æ‹©ä¸¤ä¸ªæ•°å­— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span></span></span></span> ï¼Œå…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>a</mi><mo>â‰¤</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1 \leq a \leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>b</mi><mo>â‰¤</mo><mtext>å½“å‰å¤§æ ‘çš„ç»“ç‚¹æ•°</mtext></mrow><annotation encoding="application/x-tex">1 \leq b \leq \text{å½“å‰å¤§æ ‘çš„ç»“ç‚¹æ•°}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord cjk_fallback">å½“å‰å¤§æ ‘çš„ç»“ç‚¹æ•°</span></span></span></span></span>ã€‚<br>
ï¼ˆ2.2ï¼‰å°†æ¨¡æ¿æ ‘ä¸­ä»¥ç»“ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> ä¸ºæ ¹çš„å­æ ‘å¤åˆ¶ä¸€éï¼ŒæŒ‚åˆ°å¤§æ ‘ä¸­ç»“ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> çš„ä¸‹æ–¹(ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡æ¿æ ‘ä¸­çš„ç»“ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> ä¸ºæ ¹çš„å­æ ‘å¤åˆ¶åˆ°å¤§æ ‘ä¸­åï¼Œå°†æˆä¸ºå¤§æ ‘ä¸­ç»“ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> çš„å­æ ‘)ã€‚<br>
ï¼ˆ2.3ï¼‰å°†æ–°åŠ å…¥å¤§æ ‘çš„ç»“ç‚¹æŒ‰ç…§åœ¨æ¨¡æ¿æ ‘ä¸­ç¼–å·çš„é¡ºåºé‡æ–°ç¼–å·ã€‚å‡è®¾åœ¨è¿›è¡Œ 2.2 æ­¥ä¹‹å‰å¤§æ ‘æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span> ä¸ªç»“ç‚¹ï¼Œæ¨¡æ¿æ ‘ä¸­ä»¥ a ä¸ºæ ¹çš„å­æ ‘å…±æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ä¸ªç»“ç‚¹ï¼Œé‚£ä¹ˆæ–°åŠ å…¥æ¨¡æ¿æ ‘çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ä¸ªç»“ç‚¹åœ¨å¤§æ ‘ä¸­çš„ç¼–å·å°†æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>L</mi><mo>+</mo><mn>2</mn><mo separator="true">,</mo><mo>â‹¯</mo><mtext>â€‰</mtext><mo separator="true">,</mo><mi>L</mi><mo>+</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">L+1,L+2,\cdots,L+C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ï¼›å¤§æ ‘ä¸­è¿™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ä¸ªç»“ç‚¹ç¼–å·çš„å¤§å°é¡ºåºå’Œæ¨¡æ¿æ ‘ä¸­å¯¹åº”çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span></span> ä¸ªç»“ç‚¹çš„å¤§å°é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚<br>
ç°åœ¨ç»™å®šä½ æ¨¡æ¿æ ‘ï¼Œä»¥åŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¬¡æ“ä½œçš„å…·ä½“æƒ…å†µã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®æœ€åçš„å¤§æ ‘ä¸­ä¸¤ç‚¹é—´çš„è·ç¦»ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n,m,q\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-6">Solution</h2>
<p><s>@$%^&amp;ï¼Œæ–‡æ˜é å¤§å®¶ã€‚</s><br>
æ ‘å¥—æ ‘ã€‚æˆ‘ä»¬æŠŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¬¡æ“ä½œçœ‹æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹åº”æ¨¡æ¿æ ‘ä¸­çš„ä¸€ä¸ªå­æ ‘ã€‚<br>
æ±‚ä¸¤ç‚¹é—´çš„è·ç¦»éœ€è¦æˆ‘ä»¬å®ç°æ±‚æ·±åº¦/åˆ°æ ¹èŠ‚ç‚¹è·ç¦»å’Œæ±‚ LCA ã€‚æˆ‘ä»¬åœ¨æ¨¡æ¿æ ‘å’Œå¤§æ ‘ä¸Šå¯¹åº”ç»´æŠ¤å°±è¡Œäº†ã€‚æ¯•ç«Ÿè¿™ä¸¤ä¸ªä¸œè¥¿éƒ½æ˜¯å¯ä»¥åœ¨çº¿æ±‚çš„ã€‚<br>
æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå‰ç½®æ“ä½œï¼š<code>getpos(u)</code> å’Œ <code>getnode(u)</code> ï¼Œåˆ†åˆ«æ˜¯æ‰¾åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> å¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> åœ¨æ¨¡æ¿æ ‘ä¸Šçš„å¯¹åº”èŠ‚ç‚¹ã€‚<br>
è®°å½•æ¯ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ‰€å æ®çš„ç¼–å·åŒºé—´å³å¯äºŒåˆ†å®ç° <code>getpos</code> ã€‚<code>getnode</code> å®é™…ä¸Šæ˜¯æ±‚å­æ ‘å†…ç¼–å·ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> å°ï¼Œå¯ä»¥é€šè¿‡ä¸»å¸­æ ‘è§£å†³ã€‚<br>
å‰©ä¸‹çš„å°±ä¸åœå¾€ä¸Šè·³/ç‰¹åˆ¤å°±è¡Œå•¦ã€‚å†™èµ·æ¥è¿˜æ˜¯è›®çˆ½çš„ã€‚</p>
<p>å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mo>(</mo><mi>m</mi><mo>+</mo><mi>q</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>m</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}((m+q\log_2m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mclose">)</span></span></span></span> ã€‚è¦æ³¨æ„å¸¸æ•°ã€‚</p>
<h2 id="code-6">Code</h2>
<pre><code class="language-cpp">const int N=1e5+5,M=22;
using namespace std;
namespace SEG{
#define mid (l+r&gt;&gt;1)
    int tot,t[N&lt;&lt;5],lc[N&lt;&lt;5],rc[N&lt;&lt;5];
    void modify(int pre,int &amp;p,int l,int r,int pos){
        p=++tot;t[p]=t[pre]+1;
        lc[p]=lc[pre],rc[p]=rc[pre];
        if(l==r) return;
        if(mid&gt;=pos) modify(lc[pre],lc[p],l,mid,pos);
        else modify(rc[pre],rc[p],mid+1,r,pos);
    }
    int query(int pre,int suf,int l,int r,int pos){
        if(l==r) return l;
        if(t[lc[suf]]-t[lc[pre]]&gt;=pos) return query(lc[pre],lc[suf],l,mid,pos);
        else return query(rc[pre],rc[suf],mid+1,r,pos-(t[lc[suf]]-t[lc[pre]]));
    }
#undef mid
}
namespace TEM{
    int n,dfn;
    int S[N],T[N],sz[N],rt[N],idx[N],dep[N],f[N][M];
    vector&lt;int&gt;c[N];
    void DFS(int p,int fa){
        S[p]=++dfn;idx[dfn]=p;
        f[p][0]=fa;dep[p]=dep[fa]+1;sz[p]=1;
        for(int i=0;f[p][i];++i) f[p][i+1]=f[f[p][i]][i];
        for(auto u:c[p])
            if(u^fa) DFS(u,p),sz[p]+=sz[u];
        T[p]=dfn;
    }
    int LCA(int x,int y){
        if(dep[x]&lt;dep[y]) x^=y^=x^=y;
        for(int i=20;i&gt;=0;--i)
            if(dep[f[x][i]]&gt;=dep[y]) x=f[x][i];
        if(x==y) return x;
        for(int i=20;i&gt;=0;--i)
            if(f[x][i]!=f[y][i]) x=f[x][i],y=f[y][i];
        return f[x][0];
    }
    int dis(int x,int y){
        int z=LCA(x,y);
        return dep[x]+dep[y]-2*dep[z];
    }
    void build(){
        for(int i=1,x,y;i&lt;n;++i)
            r(x,y),c[x].push_back(y),c[y].push_back(x);
        DFS(1,0);
        for(int i=1;i&lt;=n;++i)
            SEG::modify(rt[i-1],rt[i],1,n,idx[i]);
    }
}
using TEM::rt;
namespace BIG{
    int m,cnt;
    int lg[N],dep[N],link[N],inte[N],f[N][M];
    long long S[N],T[N],dis[N],tot;
    int getpos(long long x){
        int l=1,r=cnt;
        while(l&lt;=r){
            int mid=l+r&gt;&gt;1;
            if(x&gt;=S[mid]&amp;&amp;x&lt;=T[mid]) return mid;
            else if(x&gt;T[mid]) l=mid+1;
            else r=mid-1;
        }
        assert(-1);
    }
    int getnode(long long x,int pos=0){            //ä¸è¦æ— è„‘æ±‚ pos ã€‚å¡å¸¸
        if(!pos) pos=getpos(x);
        return SEG::query(rt[TEM::S[inte[pos]]-1],rt[TEM::T[inte[pos]]],1,TEM::n,x-S[pos]+1);
    }
    void build(){
        for(int i=1;i&lt;=m;++i) lg[i]=lg[i-1]+((1&lt;&lt;lg[i-1])==i);
        S[cnt=1]=1,T[1]=tot=TEM::n;dep[1]=1;inte[1]=1;
        for(int i=1,a,pos,id;i&lt;=m;++i){
            long long b;
            r(a,b);pos=getpos(b);id=getnode(b,pos);
            ++cnt;
            link[cnt]=id;inte[cnt]=a;
            S[cnt]=tot+1;T[cnt]=(tot+=TEM::sz[a]);
            f[cnt][0]=pos,dep[cnt]=dep[pos]+1;
            dis[cnt]=dis[pos]+TEM::dep[id]-TEM::dep[inte[pos]]+1;
            for(int i=0;f[cnt][i];++i) f[cnt][i+1]=f[f[cnt][i]][i];
        }
    }
    int LCA(int x,int y){
        if(dep[x]&lt;dep[y]) x^=y^=x^=y;
        for(int i=20;i&gt;=0;--i)
            if(dep[f[x][i]]&gt;=dep[y]) x=f[x][i];
        if(x==y) return x;
        for(int i=20;i&gt;=0;--i)
            if(f[x][i]!=f[y][i]) x=f[x][i],y=f[y][i];
        return f[x][0];
    }
    int jump(int x,int h){
        while(h){
            int y=f[x][lg[h]-1];
            h-=(dep[x]-dep[y]);x=y;
        }
        return x;
    }
    long long solve(long long x,long long y){
        int px=getpos(x),py=getpos(y),dx=getnode(x,px),dy=getnode(y,py);
        if(px==py) return TEM::dis(dx,dy);
        long long lca=LCA(px,py);
        long long ret=0;
        if(lca==px||lca==py){
            if(lca==py) swap(x,y),swap(px,py),swap(dx,dy);
            ret+=TEM::dep[dy]-TEM::dep[inte[py]],y=py;
            int oldy=y;y=jump(y,dep[y]-dep[lca]-1);
            ret+=dis[oldy]-dis[y]+1;y=link[y];
            ret+=TEM::dis(dx,y);
            return ret;
        }
        ret+=TEM::dep[dx]-TEM::dep[inte[px]],x=px;
        ret+=TEM::dep[dy]-TEM::dep[inte[py]],y=py;
        int oldx=x,oldy=y;
        x=jump(x,dep[x]-dep[lca]-1);
        y=jump(y,dep[y]-dep[lca]-1);
        ret+=dis[oldx]-dis[x]+1+dis[oldy]-dis[y]+1;
        return ret+TEM::dis(link[x],link[y]);
    }
}
int main(){

    int q;r(TEM::n,BIG::m,q);
    TEM::build();BIG::build();
    long long x,y;
    for(int i=1;i&lt;=q;++i)
        r(x,y),w(BIG::solve(x,y));
    return 0;
}
</code></pre>
<h1 id="analysis">Analysis</h1>
<p>5 é“æ•°æ®ç»“æ„ 1 é“è®¡ç®—å‡ ä½• ğŸ˜… å·®ä¸å¤šå¾—äº†ï¼<br>
çœé€‰è¿˜æ˜¯å¾ˆé‡è§† trick çš„è€ƒå¯Ÿã€‚å¹³å¸¸å¤šåšé¢˜ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SPOJ3734 Periodni è§£é¢˜æŠ¥å‘Š]]></title>
        <id>https://parallelist-c.github.io/post/spoj-periodni/</id>
        <link href="https://parallelist-c.github.io/post/spoj-periodni/">
        </link>
        <updated>2021-01-13T04:47:18.000Z</updated>
        <content type="html"><![CDATA[<h2 id="description">Description</h2>
<p>ç»™å®šä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> åˆ—çš„è¡¨æ ¼ï¼Œæ¯åˆ—çš„é«˜åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">h_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å„ä¸ç›¸åŒï¼Œä½†åº•éƒ¨å¯¹é½ï¼Œç„¶åå‘è¡¨æ ¼ä¸­å¡«å…¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªç›¸åŒçš„æ•°ï¼Œå¡«å†™æ—¶è¦æ±‚ä¸èƒ½æœ‰ä¸¤ä¸ªæ•°åœ¨åŒä¸€åˆ—ã€‚è‹¥ä¸¤ä¸ªæ•°åœ¨åŒä¸€è¡Œï¼Œä½†æ˜¯ä¸­é—´æŸä¸€åˆ—æ–­å¼€æ˜¯è¢«å…è®¸çš„ï¼Œå¦åˆ™ä¹Ÿä¸å…è®¸ã€‚æ±‚å¡«æ•°çš„æ–¹æ¡ˆæ•°å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>+</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">10^9+7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">7</span></span></span></span> å–æ¨¡çš„å€¼ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>â‰¤</mo><mn>500</mn><mo separator="true">,</mo><msub><mi>h</mi><mi>i</mi></msub><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">n\leq 500,h_i\leq 10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">5</span><span class="mord">0</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p>ç»å…¸é¢˜äº†ï¼Œè¿™é‡Œ mark ä¸€ä¸‹åšæ³•ã€‚<br>
å¯ä»¥å‘ç°ï¼Œå–å‡ºå…¨å±€æœ€å°çš„ä½ç½® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> åï¼Œè¯¥ä½ç½®å°†åºåˆ—åˆ†ä¸ºäº†å·¦å³ä¸¤ä¸ªéƒ¨åˆ†ã€‚è¿™ä¸¤ä¸ªéƒ¨åˆ†åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>h</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">h_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> ä»¥ä¸Šçš„éƒ¨åˆ†æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œä¹Ÿå°±è¢«åˆ’æˆäº†ä¸¤ä¸ªä¸ç›¸å…³çš„å­é—®é¢˜ã€‚<br>
å»ºå‡ºåŸæ ‘çš„ç¬›å¡å°”æ ‘ã€‚æ¯ä¸ªèŠ‚ç‚¹æŒç®¡çš„é«˜åº¦ä¸ºè‡ªå·±çš„é«˜åº¦å‡å»çˆ¶èŠ‚ç‚¹çš„é«˜åº¦ï¼Œè®¾ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><mi>h</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>âˆ’</mo><mi>h</mi><mo>[</mo><msub><mtext>fa</mtext><mi>p</mi></msub><mo>]</mo></mrow><annotation encoding="application/x-tex">H[p]=h[p]-h[\text{fa}_p]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">h</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">h</span><span class="mopen">[</span><span class="mord"><span class="mord text"><span class="mord">fa</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span> ï¼›æŒç®¡çš„é•¿åº¦ä¸ºåŒºé—´çš„é•¿åº¦ï¼Œè®¾ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>[</mo><mi>p</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">L[p]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span> ã€‚<br>
åœ¨ç¬›å¡å°”æ ‘ä¸ŠåšèƒŒåŒ…åˆå¹¶ã€‚è®¾ <code>f[p][i]</code> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> èŠ‚ç‚¹ä»£è¡¨çš„åŒºé—´é€‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸ªçš„æ–¹æ¡ˆæ•°ï¼Œé‚£ä¹ˆåˆå¹¶å­æ ‘æ—¶æœ‰ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>[</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo>]</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><mi>f</mi><mo>[</mo><msub><mtext>lc</mtext><mi>p</mi></msub><mo>]</mo><mo>[</mo><mi>i</mi><mo>]</mo><mo>Ã—</mo><mi>f</mi><mo>[</mo><msub><mtext>rc</mtext><mi>p</mi></msub><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">f[p][i+j]=\sum_{i=0}^{n}\sum_{j=0}^{n}f[\text{lc}_p][i]\times f[\text{rc}_p][j]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000007em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord"><span class="mord text"><span class="mord">lc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord"><span class="mord text"><span class="mord">rc</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span></span></p>
<p>æ¥ä¸‹æ¥è€ƒè™‘åˆå¹¶åœ¨ <code>H[p]</code> çš„èŒƒå›´å†…çš„ç‚¹ã€‚è¿™æ—¶æˆ‘ä»¬æ‰€éœ€è¦è€ƒè™‘çš„é€‰ç‚¹å°±æ˜¯åœ¨ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>Ã—</mo><mi>L</mi><mo>[</mo><mi>p</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">H[p]\times L[p]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span> çš„çŸ©å½¢å†…ã€‚<br>
å‡è®¾é€‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ªç‚¹ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬è¦é€‰å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> è¡Œï¼Œå†é€‰å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> åˆ—ï¼Œç„¶åå†å¯¹è¿™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> è¡Œå’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> åˆ—è¿›è¡ŒåŒ¹é…ã€‚<br>
äºæ˜¯å¯ä»¥çŸ¥é“</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>[</mo><mi>i</mi><mo>+</mo><mi>j</mi><mo>]</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>[</mo><mi>i</mi><mo>]</mo><mo>Ã—</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>H</mi><mo>[</mo><mi>p</mi><mo>]</mo></mrow><mi>j</mi></mfrac><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>L</mi><mo>[</mo><mi>p</mi><mo>]</mo></mrow><mi>j</mi></mfrac><mo fence="true">)</mo></mrow><mo>Ã—</mo><mi>j</mi><mo>!</mo></mrow><annotation encoding="application/x-tex">f[p][i+j]=\sum_{i=0}^{n}\sum_{j=0}^{n} f[p][i]\times \binom{H[p]}{j}\binom{L[p]}{j}\times j!
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000007em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">!</span></span></span></span></span></p>
<p>æ‰€ä»¥å°±å¾—åˆ°äº†ä¸€ä¸ªå¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>3</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> çš„åšæ³•ã€‚å¡å¡ä¸Šç•Œå°±è¿‡äº†ã€‚</p>
<h2 id="code">Code</h2>
<pre><code class="language-cpp">long long tmp[N],f[N][N];
void DFS(int p,int l,int r,int las){
    if(c[p][0]) DFS(c[p][0],l,p-1,h[p]);
    if(c[p][1]) DFS(c[p][1],p+1,r,h[p]);
    for(int i=0;i&lt;=p-l;++i)
    for(int j=0;j&lt;=r-p;++j)
        Plus(f[p][i+j],1ll*f[c[p][0]][i]*f[c[p][1]][j]%mod);
    int H=h[p]-las,L=r-l+1;
    memset(tmp,0,sizeof tmp);
    for(int i=0;i&lt;=n;++i)
    for(int j=0;j&lt;=n&amp;&amp;i+j&lt;=k;++j)
        Plus(tmp[i+j],1ll*f[p][i]*C(H,j)%mod*C(L-i,j)%mod*fac[j]%mod);
    for(int i=0;i&lt;=min(L,k);++i)
        f[p][i]=tmp[i];
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HNOI2015 è§£é¢˜æŠ¥å‘Š]]></title>
        <id>https://parallelist-c.github.io/post/hnoi2015-jie-ti-bao-gao/</id>
        <link href="https://parallelist-c.github.io/post/hnoi2015-jie-ti-bao-gao/">
        </link>
        <updated>2021-01-12T12:33:22.000Z</updated>
        <content type="html"><![CDATA[<h1 id="t1-èœè‚´åˆ¶ä½œ">T1 èœè‚´åˆ¶ä½œ</h1>
<h2 id="description">Description</h2>
<p>æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> é“èœå’Œæœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¡è¦æ±‚ï¼Œæ¯æ¡è¦æ±‚å½¢å¦‚â€œA å·èœéœ€è¦åœ¨ B å·èœçš„å‰é¢â€ã€‚ç°åœ¨è¦æ±‚ç»™å‡ºä¸€ä¸ªä¸Šèœåºåˆ—ï¼Œåœ¨æ»¡è¶³æ‰€æœ‰è¦æ±‚çš„å‰æä¸‹ï¼Œæ»¡è¶³ï¼š</p>
<ul>
<li>1 å·èœè‚´å°½é‡ä¼˜å…ˆ</li>
<li>1 å·èœè‚´å°½é‡ä¼˜å…ˆçš„æƒ…å†µä¸‹ï¼Œ2 å·èœè‚´å°½é‡ä¼˜å…ˆ</li>
<li>...</li>
</ul>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n,m\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p>æ³¨æ„åˆ°è¿™ä¸ªé¢˜å¯¹äºä¸¤ä¸ªæ’åˆ—çš„æ¯”è¾ƒæ–¹å¼ä¸æ˜¯å­—å…¸åºï¼Œè€Œæ˜¯â€œåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ¼</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">1\sim i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> çš„ä½ç½®ç›¸åŒæ—¶ï¼Œæ»¡è¶³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> çš„ä½ç½®æœ€å°â€è¿™æ ·çš„æ¯”è¾ƒæ–¹å¼ã€‚</p>
<p>å¯¹äºå­—å…¸åºçš„æ¯”è¾ƒï¼Œæˆ‘ä»¬é‡‡å–çš„é€šæ³•æ˜¯å€¼å°çš„å°½é‡é å‰ï¼›<br>
è€Œå¯¹äºæœ¬é¢˜çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬<strong>é‡‡å–çš„é€šæ³•æ˜¯å€¼å¤§çš„å°½é‡é å</strong>ã€‚</p>
<p>è¯æ˜å¯ä»¥ä»æ¯”è¾ƒæ–¹å¼å…¥æ‰‹è€ƒè™‘ã€‚å‡è®¾å½“å‰æœ‰è‹¥å¹²ä¸ªå€¼å¯ä»¥æ”¾åœ¨ç›®å‰æœ€åçš„ä½ç½®ï¼Œæœ€åæ¯”è¾ƒæ—¶ï¼Œä¸€å®šä¼šå…ˆçœ‹é‚£äº›å€¼å°çš„ï¼›å¦‚æœä¸æŠŠç›®å‰æœ€å¤§å€¼æ”¾åœ¨æœ€åï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è§†ä½œæœ€å¤§å€¼ä¸æŸä¸ªå€¼<strong>äº¤æ¢</strong>äº†ï¼Œå¯¹å…¶ä½™çš„æ•°å­—æ— å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŠŠå€¼å°çš„æ”¾åœ¨ç›®å‰æœ€åçš„ä½ç½®ï¼Œä¸€å®šæ˜¯ä¸ä¼˜çš„ã€‚</p>
<p>çŸ¥é“äº† trick é‚£ä¹ˆè¿™ä¸ªé¢˜ç›®å°±å¾ˆæ˜æ˜¾äº†ã€‚æ‹“æ‰‘æ’åºè´ªå¿ƒé€‰æ‹©å³å¯ã€‚å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code">Code</h2>
<pre><code class="language-cpp">const int N=1e5+6;
using namespace std;
int n,m,top,d[N],ans[N];
vector&lt;int&gt;g[N];
priority_queue&lt;int&gt;q;
void solve(){
    r(n,m);top=0;
    for(int i=1;i&lt;=n;++i) g[i].clear(),d[i]=0;
    for(int i=1,x,y;i&lt;=m;++i)
        r(x,y),g[y].push_back(x),++d[x];
    for(int i=1;i&lt;=n;++i)
        if(!d[i]) q.push(i);
    while(!q.empty()){
        int u=q.top();ans[++top]=u;q.pop();
        for(auto v:g[u])
            if((--d[v])==0) q.push(v); 
    }
    if(top&lt;n) return puts(&quot;Impossible!&quot;),void();
    while(top)
        w(ans[top--],' ');puts(&quot;&quot;);
}
</code></pre>
<h1 id="t2-æ¥æ°´æœ">T2 æ¥æ°´æœ</h1>
<h2 id="description-2">Description</h2>
<p>ç»™å®šä¸€æ£µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹çš„æ ‘ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ä¸ª A ç±»è·¯å¾„å’Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> ä¸ª B ç±»è·¯å¾„ã€‚A ç±»è·¯å¾„æœ‰ä¸‰ä¸ªå±æ€§ï¼Œä¸ºèµ·å§‹èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> ç»ˆæ­¢èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> æƒå€¼ w ï¼›B ç±»è·¯å¾„æœ‰ä¸‰ä¸ªå±æ€§ï¼Œä¸ºèµ·å§‹èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> ç»ˆæ­¢èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> ä»¥åŠå‚æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ã€‚å¯¹äºæ¯æ¡ B ç±»è·¯å¾„ï¼Œä¿è¯æœ‰ä¸å°‘äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> æ¡ A ç±»è·¯å¾„æ˜¯å…¶å­è·¯å¾„ï¼Œæ±‚è¿™äº›æ˜¯å…¶å­è·¯å¾„çš„ A ç±»è·¯å¾„çš„æƒå€¼ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> å°ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo separator="true">,</mo><mi>p</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>4</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">1\leq n,p,q\leq 4\times 10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-2">Solution</h2>
<p>è¦æ±‚å¯¹æ¯æ¡ B ç±»è·¯å¾„æ±‚æƒå€¼ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> å°ï¼Œè€ƒè™‘æ•´ä½“äºŒåˆ†ã€‚<br>
äºŒåˆ†æƒå€¼ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ï¼Œæ¯æ¬¡åªç®¡æƒå€¼ä¸å¤§äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> çš„ A ç±»è·¯å¾„ã€‚é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä½•æ±‚æ¯ä¸ª B åŒ…å«çš„ A çš„æ•°é‡ã€‚ä¹Ÿå°±æ˜¯å¦‚ä½•å¿«é€Ÿåˆ¤å®šä¸€æ¡è·¯å¾„æ˜¯ä¸æ˜¯å…¶ä½™è·¯å¾„çš„å­è·¯å¾„ã€‚<br>
å° trick ï¼šåˆ¤å®šè·¯å¾„æ˜¯å¦æ˜¯å­è·¯å¾„å¯ä»¥é€šè¿‡çŸ©å½¢è¦†ç›–æ¥å®ç°ã€‚<br>
<img src="https://parallelist-c.github.io/post-images/1610497717667.png" alt="" loading="lazy"><br>
å¦‚å·¦å›¾ï¼Œæ»¡è¶³è·¯å¾„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>â†’</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">s\rightarrow t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> æ˜¯å…¶å­è·¯å¾„çš„è·¯å¾„ç«¯ç‚¹å¿…ç„¶ä¸€ä¸ªåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span> å­æ ‘å†…ï¼Œä¸€ä¸ªåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> å­æ ‘å†…ã€‚å¦‚æœè®°ä¸‹æ¥è¿›/å‡ºæ¯ä¸ªç‚¹çš„å­æ ‘æ—¶çš„ dfn åºï¼Œé‚£ä¹ˆè§†ä½œä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šçš„çŸ©å½¢ã€‚<br>
å¦‚å³å›¾ï¼Œæ»¡è¶³è·¯å¾„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>â†’</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">s\rightarrow t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> æ˜¯å…¶å­è·¯å¾„çš„è·¯å¾„ç«¯ç‚¹å¿…ç„¶ä¸€ä¸ªåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> å­æ ‘çš„è¡¥é›†å†…ï¼Œä¸€ä¸ªåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> å­æ ‘å†…ã€‚å¯ä»¥è§†ä½œä¸¤ä¸ªçŸ©å½¢ã€‚<br>
ä¸Šé¢ä¸¤ç§æƒ…å†µåˆ†å¼€å¤„ç†å°±å¥½å•¦ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msubsup><mi>log</mi><mo>â¡</mo><mn>2</mn><mn>2</mn></msubsup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log^2_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code-2">Code</h2>
<pre><code class="language-cpp">const int N=4e4+5;
using namespace std;
int n,p,q,tot,num,cnt;
int head[N],nt[N&lt;&lt;1],to[N&lt;&lt;1];
int o[N],lg[N],inp[N],out[N],ans[N],dep[N],f[N][20];
struct Query{
   int x,y,z,id;
   Query(int x=0,int y=0,int z=0,int id=0):
       x(x),y(y),z(z),id(id) {}
   bool operator &lt;(const Query &amp;b)const{
       return x&lt;b.x;
   }
}Q[N],Qt[N];
struct Line{
   int x,t,b,v,val;
   Line(int x=0,int b=0,int t=0,int v=0,int val=0):
       x(x),b(b),t(t),v(v),val(val) {}
   bool operator &lt;(const Line &amp;b)const{
       return x&lt;b.x;
   }
}A[N&lt;&lt;2],At[N&lt;&lt;2];
namespace BIT{
#define lowb(x) (x&amp;(-x))
   int t[N];
   void add(int p,int v){
       while(p&lt;=n)
           t[p]+=v,p+=lowb(p);
   }
   int query(int p){
       int ret=0;
       while(p) ret+=t[p],p-=lowb(p);
       return ret;
   }
   void modify(int b,int t,int v){
       add(b,v);add(t+1,-v);
   }
}
using BIT::modify;
using BIT::query;
void solve(int AL,int AR,int QL,int QR,int VL,int VR){
   if(AL&gt;AR||QL&gt;QR) return;
   if(VL==VR){
       for(int i=QL;i&lt;=QR;++i)
           ans[Q[i].id]=o[VL];
       return;
   }
   int mid=VL+VR&gt;&gt;1;
   int now=AL,Atl=AL,Atr=AR,Qtl=QL,Qtr=QR;
   for(int i=QL;i&lt;=QR;++i){
       while(now&lt;=AR&amp;&amp;A[now].x&lt;=Q[i].x) {
           if(A[now].val&gt;o[mid]) At[Atr--]=A[now];
           else modify(A[now].b,A[now].t,A[now].v),At[Atl++]=A[now];
           ++now;
       }
       int v=query(Q[i].y);
       if(v&gt;=Q[i].z) Qt[Qtl++]=Q[i];
       else Q[i].z-=v,Qt[Qtr--]=Q[i]; 
   }
   while(now&lt;=AR) {
       if(A[now].val&gt;o[mid]) At[Atr--]=A[now];
       else modify(A[now].b,A[now].t,A[now].v),At[Atl++]=A[now];
       ++now;
   }
   
   for(int i=AL;i&lt;Atl;++i) modify(At[i].b,At[i].t,-At[i].v);
   for(int i=AL;i&lt;Atl;++i) A[i]=At[i];for(int i=AR;i&gt;Atr;--i) A[i]=At[i];
   for(int i=QL;i&lt;Qtl;++i) Q[i]=Qt[i];for(int i=QR;i&gt;Qtr;--i) Q[i]=Qt[i];
   reverse(A+Atr+1,A+AR+1);reverse(Q+Qtr+1,Q+QR+1);
   solve(AL,Atl-1,QL,Qtl-1,VL,mid);solve(Atr+1,AR,Qtr+1,QR,mid+1,VR);
}
void dfs(int p,int fa){
   inp[p]=++cnt;f[p][0]=fa;dep[p]=dep[fa]+1;
   for(int i=0;f[p][i];++i) f[p][i+1]=f[f[p][i]][i];
   for(int i=head[p];i;i=nt[i])
       if(to[i]^fa) dfs(to[i],p);
   out[p]=cnt;
}
int jump(int p,int h){
   while(h){
       int now=f[p][lg[h]-1];
       h-=dep[p]-dep[now];
       p=now;
   }
   return p;
}
void Add(int x,int y){
   ++num;nt[num]=head[x];head[x]=num;to[num]=y;
   ++num;nt[num]=head[y];head[y]=num;to[num]=x;
}
int main(){

   r(n,p,q);
   for(int i=1,a,b;i&lt;n;++i)
       r(a,b),Add(a,b);
   dfs(1,0);
   for(int i=1;i&lt;=n;++i)
       lg[i]=lg[i-1]+(1&lt;&lt;lg[i-1]==i);
   for(int i=1,a,b,c;i&lt;=p;++i){
       r(a,b,c);o[i]=c;
       if(inp[a]&gt;inp[b]) swap(a,b);
       if(out[a]&gt;=out[b]){                // b in a
           int v=jump(b,dep[b]-dep[a]-1);
           A[++tot]=Line(1,inp[b],out[b],1,c);
           A[++tot]=Line(inp[v],inp[b],out[b],-1,c);
           if(out[v]&lt;n){
               A[++tot]=Line(inp[b],out[v]+1,n,1,c);
               A[++tot]=Line(out[b]+1,out[v]+1,n,-1,c);
           }
       }   
       else{
           A[++tot]=Line(inp[a],inp[b],out[b],1,c);
           A[++tot]=Line(out[a]+1,inp[b],out[b],-1,c);
       }
   }
   for(int i=1,x,y,k;i&lt;=q;++i){
       r(x,y,k);
       if(inp[x]&gt;inp[y])
           swap(x,y);
       Q[i]=Query(inp[x],inp[y],k,i);
   }
   sort(Q+1,Q+q+1);
   sort(o+1,o+p+1);
   sort(A+1,A+tot+1);
   solve(1,tot,1,q,1,p);
   for(int i=1;i&lt;=q;++i)
       w(ans[i]);
   return 0;
}
</code></pre>
<h1 id="t3-å®éªŒæ¯”è¾ƒ">T3 å®éªŒæ¯”è¾ƒ</h1>
<h2 id="description-3">Description</h2>
<p>ç»™ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹çš„å¤–å‘æ ‘æ£®æ—ã€‚è¦æ±‚ç»™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹èµ‹æƒå€¼ï¼Œæ»¡è¶³</p>
<ul>
<li>æƒå€¼å¿…é¡»è¿ç»­ã€‚</li>
<li>çˆ¶èŠ‚ç‚¹çš„æƒå€¼å°äºå­èŠ‚ç‚¹çš„æƒå€¼ã€‚</li>
<li>å¯ä»¥ç»™ä¸åŒçš„ç‚¹èµ‹ç›¸åŒæƒå€¼ã€‚</li>
</ul>
<p>èµ‹å®Œæƒå€¼åç»™æ‰€æœ‰ç‚¹æ’åºï¼Œæƒå€¼ç›¸ç­‰çš„ç‚¹æŒ‰ç…§ç¼–å·æ’åºï¼Œç„¶åç”¨ '&lt;' æˆ–è€… '=' è¿æ¥ç›¸é‚»ä¸¤ä¸ªæ•°ã€‚æ±‚æœ‰å¤šå°‘ç§ä¸åŒçš„æœ€åçš„åºåˆ—ï¼ˆç¬¦å·ä¸åŒä¹Ÿå¯ä»¥ï¼‰ã€‚</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo>â‰¤</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">1\leq n\leq 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span></p>
<h2 id="solution-3">Solution</h2>
<p>æˆ‘ä»¬è€ƒè™‘æœ€ç»ˆçš„åºåˆ—ä¸­ ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªå°äºå·å°†åºåˆ—åˆ†æˆäº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> æ®µã€‚<br>
äºæ˜¯è½¬åŒ–ä¸ºäº†ç»å…¸çš„æŒ‰ç…§æ®µæ¥åˆ’åˆ†çš„å­æ ‘åˆå¹¶ã€‚<br>
è®¾åŸæ¥çš„åºåˆ—ä¸º A ï¼Œç›®å‰åˆå¹¶çš„åºåˆ—ä¸º B ï¼Œæ–°çš„åºåˆ—ä¸º C ã€‚C æœ‰å¦‚ä¸‹ä¸‰ä¸ªé™åˆ¶ï¼š</p>
<ul>
<li>C çš„ç¬¬ä¸€æ®µå¿…ç„¶æ˜¯å½“å‰èŠ‚ç‚¹æœ¬èº«ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ A çš„ç¬¬ä¸€æ®µã€‚</li>
<li>C çš„ä»»æ„ä¸€æ®µéç©ºã€‚</li>
<li>C é™¤ç¬¬ä¸€æ®µä»¥å¤–çš„ä»»æ„ä¸€æ®µè¦ä¹ˆç”± B ç»„æˆï¼Œè¦ä¹ˆç”± A ç»„æˆï¼Œè¦ä¹ˆç”± A B å…±åŒç»„æˆã€‚</li>
</ul>
<p>æšä¸¾ C çš„å‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> æ®µï¼Œæšä¸¾ A çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> æ®µï¼Œæšä¸¾ B çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> æ®µæ¥åˆå¹¶ã€‚</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>[</mo><mi>i</mi><mo>]</mo><mo>=</mo><mi>f</mi><mo>[</mo><mi>u</mi><mo>]</mo><mo>[</mo><mi>k</mi><mo>]</mo><mo>Ã—</mo><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo><mo>Ã—</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow></mfrac><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>j</mi><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>j</mi><mo>âˆ’</mo><mo>(</mo><mi>k</mi><mo>âˆ’</mo><mi>i</mi><mo>)</mo></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">f[p][i]=f[u][k]\times f[p][j]\times \binom{i-1}{j-1}\binom{j-1}{j-(k-i)} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">u</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.6770000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p>
<p>ç¬¬ä¸€ä¸ªç»„åˆæ•°çš„æ„ä¹‰æ˜¯å¦‚ä½•æ”¾ A çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> æ®µï¼Œç¬¬äºŒä¸ªç»„åˆæ•°çš„æ„ä¹‰æ˜¯å¦‚ä½•åˆå¹¶ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>3</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p>
<h2 id="code-3">Code</h2>
<pre><code class="language-cpp">void dp(int p,int fa=0){
    sz[p]=f[p][1]=1;
    for(int i=head[p];i;i=nt[i])if(to[i]^fa){
        int u=to[i];dp(u,p);
        memset(tmp,0,sizeof tmp);
        for(int k=1;k&lt;=sz[p]+sz[u];++k)
        for(int i=1;i&lt;=sz[p];++i)
        for(int j=1;j&lt;=sz[u];++j){
            int x=j-(k-i);if(x&lt;0) continue;
            tmp[k]=Plus(1ll*tmp[k],1ll*f[p][i]*f[u][j]%mod*c[k-1][i-1]%mod*c[i-1][x]%mod);
        }
        sz[p]+=sz[u];
        for(int k=1;k&lt;=sz[p];++k)
            f[p][k]=tmp[k];
    }
}
</code></pre>
<h1 id="t4-äºšç‘Ÿç‹">T4 äºšç‘Ÿç‹</h1>
<h2 id="description-4">Description</h2>
<p>æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> å¼ å¡ç‰Œï¼Œæ¯å¼ å¡ç‰Œæœ‰ä¸¤ä¸ªå±æ€§ï¼šä¼¤å®³å€¼ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> å’Œå‘å‡ºæŠ€èƒ½çš„æ¦‚ç‡å€¼ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ã€‚åœ¨æ¯ä¸€è½®ä¸­ï¼Œç³»ç»Ÿå°†ä»ç¬¬ä¸€å¼ å¡ç‰Œå¼€å§‹ï¼ŒæŒ‰ç…§é¡ºåºæšä¸¾æ¯å¼ å¡ç‰Œã€‚å¦‚æœå½“å‰çš„å¡ç‰Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å·²ç»å‘åŠ¨è¿‡æŠ€èƒ½ï¼Œåˆ™ç›´æ¥è·³è¿‡ï¼›å¦åˆ™ï¼Œæœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ¦‚ç‡æ”¾å‡ºæŠ€èƒ½å¹¶ç»“æŸè¿™ä¸€è½®ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">1-p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æ¦‚ç‡æœªæ”¾å‡ºï¼Œå¹¶æšä¸¾ä¸‹ä¸€å¼ å¡ç‰Œã€‚<br>
ç»™å®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> å’Œæ¸¸æˆè½®æ•° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> ï¼Œæ±‚æœŸæœ›é€ æˆçš„ä¼¤å®³ã€‚T ç»„æ•°æ®ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>T</mi><mo>â‰¤</mo><mn>444</mn><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo>â‰¤</mo><mn>220</mn><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>r</mi><mo>â‰¤</mo><mn>132</mn><mo separator="true">,</mo><mn>0</mn><mo>&lt;</mo><msub><mi>p</mi><mi>i</mi></msub><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1\leq T \leq 444,1\leq n\leq 220,1\leq r\leq 132,0&lt; p_i&lt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">4</span><span class="mord">4</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord">3</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<h2 id="solution-4">Solution</h2>
<p>æœŸæœ›çš„é¢˜ç›®ä¸€èˆ¬éƒ½è¦åˆ†å¼€è®¡ç®—è´¡çŒ®ã€‚å¦‚æœ¬é¢˜ï¼Œè‹¥æ±‚å‡ºæ¥äº†ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å¼ å¡ç‰Œæ”¾å‡ºæŠ€èƒ½çš„æ¦‚ç‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>g</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">g_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼Œé‚£ä¹ˆæœŸæœ›å°±å¥½åšäº†ã€‚<br>
ç›´æ¥æ±‚æ”¾å‡ºæŠ€èƒ½çš„æ¦‚ç‡è¿˜éœ€è¦æšä¸¾ç¬¬å‡ è½®æ”¾å‡ºæ¥çš„ï¼Œæˆ‘ä»¬è½¬åŒ–æˆæšä¸¾è¡¥é›†ï¼Œè®¡ç®—ä¸æ”¾å‡ºçš„æ¦‚ç‡ã€‚<br>
å¯ä»¥å‘ç°ä¸€ä¸ªé‡è¦çš„æ€§è´¨ï¼šç”±äºæ˜¯é¡ºåºæšä¸¾ï¼Œæ‰€ä»¥å½“ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¹‹å‰çš„å¡ç‰Œé‡Šæ”¾æŠ€èƒ½æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> æœ¬è½®å°±ä¸ç”¨ç»å† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ’</mo><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">1-p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> çš„æŠ‰æ‹©ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¹‹å‰æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ªå¡ç‰Œé‡Šæ”¾äº†æŠ€èƒ½ï¼Œé‚£ä¹ˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸æ”¾å‡ºçš„æ¦‚ç‡æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mn>1</mn><mo>âˆ’</mo><msub><mi>p</mi><mi>i</mi></msub><msup><mo>)</mo><mrow><mi>r</mi><mo>âˆ’</mo><mi>k</mi></mrow></msup></mrow><annotation encoding="application/x-tex">(1-p_i)^{r-k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0991079999999998em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span><br>
è®¾ <code>f[i][j]</code> è¡¨ç¤ºåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> è½®ä¸­ï¼Œå‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å¼ å¡ç‰‡é‡Šæ”¾å‡º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> æ¬¡æŠ€èƒ½çš„æ¦‚ç‡ã€‚è€ƒè™‘ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å¼ å¡ç‰Œæ˜¯å¦é‡Šæ”¾æŠ€èƒ½å¯å¾—ï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>f</mi><mo>[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo><mo>[</mo><mi>j</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo><mo>Ã—</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo>[</mo><mi>i</mi><mo>]</mo><msup><mo>)</mo><mrow><mi>r</mi><mo>âˆ’</mo><mo>(</mo><mi>j</mi><mo>âˆ’</mo><mn>1</mn><mo>)</mo></mrow></msup><mo>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>f</mi><mo>[</mo><mi>i</mi><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>f</mi><mo>[</mo><mi>i</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo><mo>[</mo><mi>j</mi><mo>]</mo><mo>Ã—</mo><mo>(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo>[</mo><mi>i</mi><mo>]</mo><msup><mo>)</mo><mrow><mi>r</mi><mo>âˆ’</mo><mi>j</mi></mrow></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
f[i][j]&amp;=f[i-1][j-1]\times (1-(1-p[i])^{r-(j-1)})\\
f[i][j]&amp;=f[i-1][j]\times (1-p[i])^{r-j}\\
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.132664em;vertical-align:-1.316332em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.816332em;"><span style="top:-3.8783320000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span><span style="top:-2.343668em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.316332em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.816332em;"><span style="top:-3.8783320000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">p</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">âˆ’</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.343668em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">p</span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.316332em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>æ±‚å‡ºæ¥ f æ•°ç»„ï¼Œæ±‚å‡º i ä¸æ”¾å‡ºçš„æ¦‚ç‡å°±å¥½åšäº†ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>T</mi><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(Tn^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code-4">Code</h2>
<pre><code class="language-cpp">void solve(){
    cin&gt;&gt;n&gt;&gt;m;
    memset(f,0,sizeof f);
    memset(q,0,sizeof q);
    for(int i=1;i&lt;=n;++i)
        cin&gt;&gt;p[i]&gt;&gt;d[i];
    for(int i=1;i&lt;=n;++i){
        q[i][0]=1,q[i][1]=1-p[i];
        for(int j=2;j&lt;=m;++j) 
            q[i][j]=q[i][j-1]*(1-p[i]);
    }
    f[0][0]=1;
    for(int i=1;i&lt;n;++i)
    for(int j=0;j&lt;=i&amp;&amp;j&lt;=m;++j){
        f[i][j]+=f[i-1][j]*q[i][m-j];
        if(j) f[i][j]+=f[i-1][j-1]*(1-q[i][m-j+1]);
    }
    double ans=0;
    for(int i=1;i&lt;=n;++i){
        double tmp=0;
        for(int j=0;j&lt;=i-1;++j)
            tmp+=f[i-1][j]*(1-q[i][m-j]);
        ans+=tmp*d[i];
    }
    printf(&quot;%.10lf\n&quot;,ans);
}
</code></pre>
<h1 id="t5-è½å¿†æ«éŸ³">T5 è½å¿†æ«éŸ³</h1>
<h2 id="description-5">Description</h2>
<p>ç»™ä¸€å¼  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹çš„ DAG å’Œä¸€æ¡è¾¹ï¼Œæ±‚ä»¥ 1 ä¸ºæ ¹çš„å¤–å‘æ ‘ä¸ªæ•°ã€‚ä¿è¯ 1 å·ç‚¹æ²¡æœ‰å…¥è¾¹ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo separator="true">,</mo><mn>1</mn><mo>â‰¤</mo><mi>m</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">1\leq n\leq 10^5,1\leq m\leq 2\times 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-5">Solution</h2>
<p>è®¾ <code>d[i]</code> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> å·ç‚¹çš„å…¥åº¦ã€‚é’¦å®š 1 å·ç‚¹çš„å…¥åº¦ä¸º 1 ã€‚<br>
è‹¥æ²¡æœ‰é¢å¤–çš„è¾¹ï¼Œæˆ‘ä»¬è€ƒè™‘æ ‘ä¸Šæ¯ä¸ªç‚¹çš„çˆ¶äº²å¯å¾—å¤–å‘æ ‘ä¸ªæ•°ä¸º</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\prod_{i=1}^{n}d_i
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>ç°åœ¨æœ‰äº†é¢å¤–çš„è¾¹ï¼Œæ„å‘³ç€ä»»æ„è¿è¾¹çš„è¯å¯èƒ½è¿å‡ºç¯ã€‚æˆ‘ä»¬éœ€è¦å‡å»ä¸åˆæ³•çš„æ–¹æ¡ˆã€‚<br>
å‡è®¾è¿™æ¡è¾¹ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>â†’</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">s\rightarrow t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>â†’</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">s\rightarrow t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathdefault">t</span></span></span></span> è¿™æ¡è¾¹è¿ä¸Šåå¯èƒ½ä¼šå½¢æˆè‹¥å¹²ä¸ªç¯ï¼Œè¿™äº›ç¯çš„æ–¹æ¡ˆä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ˆå› ä¸ºç”Ÿæˆæ ‘å†…ä¸å¯èƒ½åŒæ—¶æœ‰ä¸¤ä¸ªç¯ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬å•ç‹¬è€ƒè™‘æŸä¸ªç¯ã€‚<br>
è‹¥è¿™ä¸ªç¯ä¸Šçš„ç‚¹ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>a</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â‹¯</mo><mtext>â€‰</mtext><mo separator="true">,</mo><msub><mi>a</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">a_1,a_2,\cdots,a_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼Œæˆ‘ä»¬é’¦å®šç¯ä¸Šçš„ç‚¹åœ¨æ ‘ä¸Šä¹Ÿæ°å¥½è¿æˆä¸€ä¸ªç¯ï¼Œé‚£ä¹ˆæ–¹æ¡ˆä¸ºï¼š</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msub><mi>d</mi><mi>i</mi></msub></mrow><mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><msub><mi>d</mi><msub><mi>a</mi><mi>i</mi></msub></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\prod\limits_{i=1}^{n}d_i}{\prod\limits_{i=1}^{k}d_{a_i}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.122848em;vertical-align:-2.4037820000000005em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.7190659999999998em;"><span style="top:-2.1099999999999994em;"><span class="pstrut" style="height:3.5361130000000003em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5361130000000003em;"><span style="top:-2.122331em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ</span></span></span><span style="top:-3.950005em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9776689999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.7661130000000003em;"><span class="pstrut" style="height:3.5361130000000003em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.903782em;"><span class="pstrut" style="height:3.5361130000000003em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3513970000000004em;"><span style="top:-2.122331em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ</span></span></span><span style="top:-3.950005em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9776689999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.4037820000000005em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>äºæ˜¯ç»Ÿè®¡æ¯ä¸€ä¸ªæˆç¯çš„æ–¹æ¡ˆå°±è¡Œäº†ã€‚è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ä» t å‡ºå‘æ‰¾ s ï¼Œåœ¨ dfs çš„æ—¶å€™é¡ºä¾¿ç»Ÿè®¡ã€‚<br>
ä½†æ˜¯æœ€å¤šæœ‰ n ä¸ªç¯ï¼Œæš´åŠ›åšæ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> çš„ã€‚<br>
åœ¨ç»è¿‡äº†æŸä¸ªç‚¹åï¼Œä»è¯¥ç‚¹å‡ºå‘åˆ° s çš„è¿™äº›è·¯å¾„ä¸Šçš„æƒå€¼æ˜¯ä¸å˜çš„ã€‚æˆ‘ä»¬å¯ä»¥è®¾ä¸º <code>f[p]</code> ã€‚<br>
é‚£ä¹ˆæœ‰è½¬ç§»</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><mfrac><mn>1</mn><msub><mi>d</mi><mi>p</mi></msub></mfrac><mo>âˆ‘</mo><mi>f</mi><mo>[</mo><mi>u</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">f[p]=\frac{1}{d_p}\sum f[u]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.293548em;vertical-align:-0.972108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">u</span><span class="mclose">]</span></span></span></span></span></p>
<p>è¾¹ç•Œæ¡ä»¶ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mi>s</mi></msub><mo>=</mo><mfrac><mrow><msubsup><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>d</mi><mi>i</mi></msub></mrow><msub><mi>d</mi><mi>s</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">f_s=\frac{\prod\limits_{i=1}^{n}d_i}{d_s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.456547em;vertical-align:-0.44509999999999994em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.011447em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.0310635em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop op-limits mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4005478571428571em;"><span style="top:-1.8629092857142857em;margin-left:0em;"><span class="pstrut" style="height:2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-2.7500050000000003em;"><span class="pstrut" style="height:2.75em;"></span><span><span class="mop op-symbol small-op mtight">âˆ</span></span></span><span style="top:-3.700005em;margin-left:0em;"><span class="pstrut" style="height:2.75em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0300907142857143em;"><span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.44509999999999994em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> ã€‚<br>
æœ€ç»ˆçš„ç­”æ¡ˆå°±æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>d</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>f</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\prod\limits_{i=1}^{n}d_i-f_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.329066em;vertical-align:-0.9776689999999999em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3513970000000004em;"><span style="top:-2.122331em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0000050000000003em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ</span></span></span><span style="top:-3.950005em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9776689999999999em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">t</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ã€‚å¤æ‚åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code-5">Code</h2>
<pre><code class="language-cpp">int f[N],ans=1;
void dp(int p){
    if(vis[p]) return void();vis[p]=1;
    if(p==s){
        f[p]=1ll*ans*Q(ind[p],mod-2)%mod;
        return;
    }
    for(auto v:c[p]) dp(v),f[p]=(f[p]+f[v])%mod;
    f[p]=1ll*f[p]*Q(ind[p],mod-2)%mod;
}
int main(){

    r(n,m,s,t);c[s].push_back(t);
    for(int i=1,x,y;i&lt;=m;++i)
        r(x,y),c[x].push_back(y),++ind[y];
    ++ind[1];++ind[t];
    for(int i=1;i&lt;=n;++i)
        ans=1ll*ans*ind[i]%mod;
    dp(t);
    w((ans-f[t]+mod)%mod);
    return 0;
}
</code></pre>
<h1 id="t6-å¼€åº—">T6 å¼€åº—</h1>
<h2 id="description-6">Description</h2>
<p>ç»™å®šä¸€æ£µ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹çš„æ ‘ï¼Œæ¯ä¸ªç‚¹æœ‰ä¸€ä¸ªå¦–æ€ªï¼Œå¹´é¾„ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡å¹½é¦™æ‰“ç®—åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> å»ºç«‹ä¸€ä¸ªé¢å‘å¹´é¾„ L åˆ° R ä¹‹é—´çš„ä¾¿åˆ©åº—ï¼Œå¥¹éœ€è¦ä½ å‘Šè¯‰å¥¹æ‰€æœ‰å¹´é¾„åœ¨ L åˆ° R ä¹‹é—´çš„å¦–æ€ªï¼Œåˆ°ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> çš„è·ç¦»çš„å’Œæ˜¯å¤šå°‘<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>q</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n,q\leq 2\times 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span> ã€‚</p>
<h2 id="solution-6">Solution</h2>
<p>å»ºç‚¹åˆ†æ ‘ï¼Œæ¯ä¸ªç‚¹ç”¨ vector ç»´æŠ¤è‡ªå·±çš„è´¡çŒ®å’Œéœ€å®¹æ–¥çš„å€¼ã€‚<br>
æ³¨æ„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msup><mi>log</mi><mo>â¡</mo><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log^2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span> çš„ç©ºé—´æ˜¯æ— æ³•é€šè¿‡æœ¬é¢˜çš„ï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½ç”¨çº¿æ®µæ ‘æ¥ç»´æŠ¤ï¼‰ã€‚<br>
åšé¢˜æ—¶ä¸åº”è¯¥æ”¾å¼ƒç”¨ vector ç»´æŠ¤çš„å¯èƒ½ã€‚vector ä¸ŠäºŒåˆ†ä¹Ÿæ˜¯è¾ƒå¥½çš„é€‰æ‹©ã€‚</p>
<h2 id="code-6">Code</h2>
<pre><code class="language-cpp">struct L{
    int cnt,tot;
    int fst[N],dep[N],dfn[N],idx[N],eul[N&lt;&lt;1],lg[N&lt;&lt;1],f[N&lt;&lt;1][20];
    void dfs(int p,int fa){
        dfn[p]=++cnt;idx[cnt]=p;
        eul[++tot]=cnt;fst[p]=tot;
        for(int i=head[p];i;i=nt[i])
            if(to[i]!=fa) dep[to[i]]=dep[p]+val[i],dfs(to[i],p),eul[++tot]=dfn[p];
    }
    void Init(){
        dfs(1,0);
        for(int i=1;i&lt;=tot;++i) f[i][0]=eul[i];
        for(int i=2;i&lt;=tot;++i) lg[i]=lg[i&gt;&gt;1]+1;
        for(int j=1;j&lt;=lg[tot];++j)
        for(int i=1;i+(1&lt;&lt;j)-1&lt;=tot;++i)
            f[i][j]=min(f[i][j-1],f[i+(1&lt;&lt;j-1)][j-1]);
    }
    inline int LCA(int x,int y){
        x=fst[x],y=fst[y];
        if(x&gt;y) swap(x,y);
        int k=lg[y-x+1];
        return idx[min(f[x][k],f[y-(1&lt;&lt;k)+1][k])];
    }
    inline int dis(int x,int y){return dep[x]+dep[y]-dep[LCA(x,y)]*2;}
}l;
inline void Add(int x,int y,int z){
    ++num;nt[num]=head[x];head[x]=num;to[num]=y;val[num]=z;
    ++num;nt[num]=head[y];head[y]=num;to[num]=x;val[num]=z;
}
void Getrt(int p,int fa){
	int Max=0;size[p]=1;
	for(int i=head[p];i;i=nt[i]){
		if(to[i]==fa||lock[to[i]]) continue;
		Getrt(to[i],p);size[p]+=size[to[i]];
		Max=max(Max,size[to[i]]);
	}
	Max=max(Max,Part-size[p]);
	if(Max&lt;Min) rt=p,Min=Max;
}
void solve(int p,int fa,int sz){
	par[p]=fa;lock[p]=1;dsz[p]=sz;
	int tmp=Part;
	for(int i=head[p];i;i=nt[i]){
		if(lock[to[i]]) continue;
		if(size[to[i]]&gt;size[p]) Part=tmp-size[p];
		else Part=size[to[i]];
		Min=n+1;Getrt(to[i],p);solve(rt,p,Part);
	}
}
struct Node{
    long long v,d,c;
    Node(long long v=0,long long d=0,long long c=0):v(v),d(d),c(c) {}
    Node operator -(const Node &amp;b)const{return Node(0,d-b.d,c-b.c);}
    bool operator &lt;(const Node &amp;b)const{return v&lt;b.v;}
};
vector&lt;Node&gt;v[N&lt;&lt;1];
#define iter vector&lt;Node&gt;::iterator 
void Build(){
    for(int i=1;i&lt;=n;++i){
        v[i].push_back(Node(X[i],0,1));
        v[i].push_back(Node(-1,0,1));v[i+n].push_back(Node(-1,0,1));
        for(int j=i;par[j];j=par[j]){
            int d=l.dis(i,par[j]);
            v[par[j]].push_back(Node(X[i],d,1));
            v[j+n].push_back(Node(X[i],d,1));
        }
    }
    for(int i=1;i&lt;=n;++i){
        sort(v[i].begin(),v[i].end());
        sort(v[i+n].begin(),v[i+n].end());
        int sz=v[i].size();
        for(int j=1;j&lt;sz;++j)
            v[i][j].d+=v[i][j-1].d,v[i][j].c+=v[i][j-1].c;
        sz=v[i+n].size();
        for(int j=1;j&lt;sz;++j)
            v[i+n][j].d+=v[i+n][j-1].d,v[i+n][j].c+=v[i+n][j-1].c;
        
    }
}

inline Node Calc(int u,int L,int R){
    int sz=v[u].size();
    iter t1=upper_bound(v[u].begin(),v[u].end(),Node(L-1,0,0)),t2=upper_bound(v[u].begin(),v[u].end(),Node(R,0,0));
    --t1;--t2;
    return Node(*(t2)-*(t1));
}
long long Query(int u,int L,int R){
    long long ret=Calc(u,L,R).d;
    for(int i=u;par[i];i=par[i]){
        long long d=l.dis(u,par[i]);
        Node cur1=Calc(par[i],L,R),cur2=Calc(i+n,L,R);
        ret+=(cur1.d-cur2.d);
        ret+=1ll*(cur1.c-cur2.c)*d;
    }
    return ret;
}
int main(){

    r(n),r(q),r(A);
    for(int i=1;i&lt;=n;++i) 
        r(X[i]),++X[i];
    for(int i=1,x,y,z;i&lt;n;++i)
        r(x),r(y),r(z),Add(x,y,z);
    Min=n+1;Part=n;Getrt(1,0);solve(rt,0,n);
    long long las=0;l.Init();Build();
    for(int i=1,u,a,b;i&lt;=q;++i){
        r(u),r(a),r(b);
        int L=min((a+las)%A+1,(b+las)%A+1),R=max((a+las)%A+1,(b+las)%A+1);
        w(las=Query(u,L,R));putchar(10);
    }
    return 0;
}
</code></pre>
<h1 id="analysis">Analysis</h1>
<p>HNOI2015 çš„è´¨é‡æŒºé«˜ï¼Œæ•´ä½“ç é‡ä¸å¤§ï¼Œä¸ªåˆ«é¢˜ç›®ç é‡ä¸å°ã€‚æœ‰ 3 é“ åŠ¨æ€è§„åˆ’ 2 é“æ•°æ®ç»“æ„ 1 é“è´ªå¿ƒã€‚åº”è¯¥ç®—æ˜¯ä¸€åœºæ¯”è¾ƒæ ‡å‡†çš„æ¯”èµ›ã€‚<br>
èœè‚´åˆ¶ä½œ è€ƒå¯Ÿäº†ä¸€ä¸ªå¯èƒ½æ¯”è¾ƒå¸¸è§çš„ trick ã€‚æ‰€ä»¥è¯´å¹³å¸¸ä¹Ÿè¦å¤šæ‰“ Atcoder/Codeforces çš„æ¯”èµ›æ¥ç§¯ç´¯è¿™äº›æ–¹æ³•ã€‚<br>
æ¥æ°´æœ è€ƒå¯Ÿäº†æ•´ä½“äºŒåˆ†å’ŒçŸ©å½¢è¦†ç›–ã€‚æ•´ä½“äºŒåˆ†å¯ä»¥ä»é¢˜ç›®æè¿°ä¸­æƒ³åˆ°ï¼ŒçŸ©é˜µè¦†ç›–éœ€è¦æ‰‹ç©â€œè·¯å¾„çš„å­è·¯å¾„â€çš„æ€§è´¨æ¥å‘ç°ã€‚dfs åºæ˜¯å¾ˆæ´»çš„ä¸œè¥¿ï¼Œå¹³å¸¸ä¹Ÿè¦å¤šæƒ³ï¼Œåšé¢˜æ—¶ä¹Ÿè¦é¢å¤–æ€è€ƒä¸€ä¸‹ã€‚<br>
å®éªŒæ¯”è¾ƒ è€ƒå¯Ÿäº†æ ‘ä¸Šåˆå¹¶å’Œæ’åˆ—ç»„åˆã€‚è¿™ç±»é¢˜ç›®æ€è·¯å·®ä¸å¤šï¼Œåœ¨å®é™…åšçš„æ—¶å€™æƒ³æ¸…æ¥šçŠ¶æ€æ¨å¥½å¼å­ã€‚<br>
äºšç‘Ÿç‹ è€ƒå¯Ÿäº†æ¦‚ç‡æœŸæœ›ã€‚åšé¢˜ç›®æ—¶ä¸åº”æ€»æ˜¯æƒ³ç€ç”¨çº¿æ€§æ€§è§£å†³ä¸€åˆ‡ï¼Œæœ‰æ—¶ä¹Ÿå¯ä»¥ä»æ¡ä»¶æ¦‚ç‡çš„è§’åº¦å‡ºå‘ï¼Œæ‰¾åˆ°æ¡ä»¶çš„ç‰¹ç‚¹ï¼Œè½¬åŒ–é—®é¢˜ã€‚<br>
è½å¿†æ«éŸ³ è€ƒå¯Ÿäº†è®¡æ•° dp ã€‚å¦‚æœå¯ä»¥æƒ³åˆ°æšä¸¾ç”Ÿæˆæ ‘ä¸Šæ¯ä¸ªç‚¹çš„çˆ¶äº²é¢˜ç›®å°±å¥½åšäº†ã€‚<br>
å¼€åº— è€ƒå¯Ÿäº†ç‚¹åˆ†æ ‘ã€‚åˆç†é€‰æ‹©ç‚¹åˆ†æ ‘å†…éƒ¨è¿›è¡Œè®¡ç®—/å®¹æ–¥çš„æ•°æ®ç»“æ„æ˜¯ç‚¹åˆ†æ ‘çš„ç²¾åæ‰€åœ¨ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[CF932G Palindrome Partition è§£é¢˜æŠ¥å‘Š]]></title>
        <id>https://parallelist-c.github.io/post/cf932g-palindrome-partition-jie-ti-bao-gao/</id>
        <link href="https://parallelist-c.github.io/post/cf932g-palindrome-partition-jie-ti-bao-gao/">
        </link>
        <updated>2021-01-11T13:45:23.000Z</updated>
        <content type="html"><![CDATA[<h2 id="description">Description</h2>
<p>ç»™å®šä¸€ä¸ªä¸²ï¼ŒæŠŠä¸²åˆ†æˆå¶æ•°æ®µï¼Œå‡è®¾ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â‹¯</mo><mtext>â€‰</mtext><mo separator="true">,</mo><msub><mi>s</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">s_1,s_2,\cdots,s_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼Œè¦æ±‚æ»¡è¶³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mn>1</mn></msub><mo>=</mo><msub><mi>s</mi><mi>k</mi></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo>=</mo><msub><mi>s</mi><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>â‹¯</mo></mrow><annotation encoding="application/x-tex">s_1=s_k,s_2=s_{k-1},\cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â‹¯</span></span></span></span> ï¼Œæ±‚æ–¹æ¡ˆæ•°ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p><s>æ ‡é¢˜é€éœ²ç®—æ³•ç³»åˆ—</s><br>
é¦–å…ˆè¿™é“é¢˜æœ‰ä¸ªç¥ä»™æ€§è´¨ã€‚</p>
<blockquote>
<p>è®¾ <code>t=s[1]s[n]s[2]s[n-1]...</code> ï¼Œé‚£ä¹ˆ <code>t</code> ä¸²çš„ä¸€ä¸ªå¶å›æ–‡åˆ’åˆ†å¯¹åº”ç€ <code>s</code> ä¸²çš„ä¸€ä¸ªé¢˜ç›®è¦æ±‚çš„åˆ’åˆ†ã€‚</p>
</blockquote>
<p>æ²¡å‘ç°æ€§è´¨æ˜¯çœŸçš„ä¸å¥½æƒ³...ä½†æ˜¯çŸ¥é“äº†ä»¥åå¯ä»¥é€šè¿‡å½’çº³æ¥è¯æ˜ã€‚</p>
<p>whateverï¼Œç°åœ¨é—®é¢˜è½¬åŒ–ä¸ºæ±‚ä¸€ä¸ªä¸²çš„å¶å›æ–‡åˆ’åˆ†æ–¹æ¡ˆæ•°ã€‚<br>
è€ƒè™‘æš´åŠ›åšæ³•ã€‚è®¾ <code>f[p]</code> è¡¨ç¤ºä»¥ p ç»“å°¾çš„å‰ç¼€çš„å¶å›æ–‡åˆ’åˆ†æ–¹æ¡ˆæ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬æ„å»ºå‡º PAM ï¼Œç„¶ååœ¨ fail æ ‘ä¸Šè·³ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯å¶å›æ–‡ä¸²å¹¶æš´åŠ›æ›´æ–°ã€‚è¿™æ ·çš„å¤æ‚åº¦æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> çš„ã€‚<br>
è€ƒè™‘å›æ–‡æ ‘ä¸Š fail çš„æ€§è´¨</p>
<blockquote>
<p>å›æ–‡ä¸²çš„æœ€å¤§å›æ–‡åç¼€æ˜¯å…¶ border ã€‚<br>
å½“æœ€å¤§å›æ–‡åç¼€é•¿åº¦ä¸å°äºåŸä¸²é•¿åº¦çš„ä¸€åŠæ—¶ï¼Œæœ€å¤§å›æ–‡åç¼€åœ¨åŸä¸²ä¸­ä»…å‡ºç°ä¸¤æ¬¡ï¼Œä¸€æ¬¡ä½œä¸ºåŸä¸²å‰ç¼€ï¼Œä¸€æ¬¡ä½œä¸ºåŸä¸²åç¼€ã€‚</p>
</blockquote>
<p>æ ¹æ®ä¸Šè¿°æ€§è´¨ï¼Œæˆ‘ä»¬æŠŠ DP çš„è¿‡ç¨‹ç»˜åˆ¶å‡ºæ¥ï¼Œçœ‹çœ‹å¦‚ä½•ä¼˜åŒ–ã€‚<br>
<img src="https://parallelist-c.github.io/post-images/1610605639535.png" alt="" loading="lazy"><br>
å¦‚å›¾ï¼Œä¸Šé¢çš„å­—ç¬¦ä¸²æ˜¯ä¸‹é¢çš„å­—ç¬¦ä¸²é•¿åº¦ä¸å°äºä¸€åŠçš„æœ€å¤§å›æ–‡åç¼€ã€‚<br>
å¦‚æœæš´åŠ›æ›´æ–°ï¼Œæ­¤æ—¶ <code>f[p]</code> åº”è¯¥æ˜¯ <code>f[a]+f[b]+f[c]+f[d]</code> ã€‚<br>
å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ<code>f[p]</code> çš„å¤§éƒ¨åˆ†å€¼å…¶å®åœ¨ <code>f[p']=f[a']+f[b']+f[c']</code> å¤„è®¡ç®—è¿‡äº†ã€‚<br>
å½“ç„¶ï¼Œåœ¨ <code>f[p']</code> å¤„æˆ‘ä»¬ä¸ä¸€å®šè®¡ç®—äº†å…¶å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¦è®¾ <code>g[p]</code> ï¼Œè¡¨ç¤ºåœ¨ PAM ä¸Šä»¥ p ä¸ºæœ«é¡¹çš„ç­‰å·®æ•°åˆ—çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>âˆ‘</mo><mi>f</mi></mrow><annotation encoding="application/x-tex">\sum f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span></span></span></span> ï¼Œå°±å¯ä»¥å¿«é€Ÿæ›´æ–° <code>f[p]</code> äº†ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šä¸‡ä¸€ <code>f[a]</code> æ›´æ–°äº† <code>f[p]</code> ï¼Œä½†æ˜¯ <code>t[a:p]</code> æ˜¯å¥‡å›æ–‡ä¸²æ€ä¹ˆåŠï¼Ÿæ²¡å…³ç³»ï¼Œè€ƒè™‘åˆ°åŸæ•°ç»„ä¸­åªæœ‰å¶æ•°çš„ä½ç½®åº”è¯¥æœ‰ <code>f</code> å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶ä¸è½¬ç§»åˆ°å¥‡æ•°ä½ç½®ã€‚å½“ <code>p</code> æ˜¯å¶æ•°ä½ç½®æ—¶ï¼Œèƒ½æ›´æ–°åˆ° <code>p</code> çš„ä½ç½®ä¹Ÿåªèƒ½æ˜¯å¶æ•°ä½ç½®ï¼Œå…¶ä¸­çš„å­—ç¬¦ä¸²è‡ªç„¶å°±æ˜¯å¶å›æ–‡ä¸²äº†ã€‚</p>
<p>ä¸åœ¨åŒä¸€ä¸ªç­‰å·®æ•°åˆ—é‡Œçš„è‡³å¤šåªæœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">\log_2n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span></span></span></span> ç»„ï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code">Code</h2>
<pre><code class="language-cpp">const int N=1e6+5,mod=1e9+7;
using namespace std;
char s[N],t[N];
namespace PAM{
    int dfn,las,top,tot;
    int dif[N],bot[N],pos[N];
    int f[N],g[N];
    struct node{
        int len,fail,c[26];
    }a[N];
    int getfail(int x){
        while(s[top]!=s[top-a[x].len-1])
            x=a[x].fail;
        return x;
    }
    void extend(int k){
        ++top;
        int cur=getfail(las);
        if(!a[cur].c[k]){
            int now=++tot;
            a[now].len=a[cur].len+2;
            a[now].fail=a[getfail(a[cur].fail)].c[k];
            dif[now]=a[now].len-a[a[now].fail].len;
            bot[now]=dif[now]==dif[a[now].fail]?bot[a[now].fail]:now;
            a[cur].c[k]=now;
        }
        las=a[cur].c[k];
    }
    void build(char *s){
        int len=strlen(s+1);
        las=tot=1;top=0;
        a[0].len=0,a[1].len=-1;
        a[0].fail=a[1].fail=1;
        for(int i=1;i&lt;=len;++i)
            extend(s[i]-'a'),pos[i]=las;
    }
    void solve(int n){
        f[0]=1;
        for(int i=1;i&lt;=n;++i)
        for(int j=pos[i];j;j=a[bot[j]].fail){
            int t=bot[j];
            if(t!=j) g[j]=g[a[j].fail];
            else g[j]=0;
            if(a[t].len) 
                g[j]=(g[j]+f[i-a[t].len])%mod;
            if(i%2==0) 
                f[i]=(f[i]+g[j])%mod;
        }
        printf(&quot;%d\n&quot;,f[n]);
    }
}
int main(){

    scanf(&quot;%s&quot;,t+1);
    int len=strlen(t+1);
    for(int i=1;i&lt;=len;++i)
        s[i]=i%2==0?t[len-i/2+1]:t[i+1&gt;&gt;1];
    PAM::build(s);
    PAM::solve(len);
    return 0;
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŒºé—´æœ¬è´¨ä¸åŒï¼ˆå›æ–‡ï¼‰å­ä¸²ä¸ªæ•°]]></title>
        <id>https://parallelist-c.github.io/post/qu-jian-ben-zhi-bu-tong-hui-wen-zi-chuan-ge-shu/</id>
        <link href="https://parallelist-c.github.io/post/qu-jian-ben-zhi-bu-tong-hui-wen-zi-chuan-ge-shu/">
        </link>
        <updated>2021-01-11T04:01:06.000Z</updated>
        <content type="html"><![CDATA[<p>sourceï¼šåŒºé—´æœ¬è´¨ä¸åŒå­ä¸²(Luogu6292) åŒºé—´æœ¬è´¨ä¸åŒå›æ–‡å­ä¸²(bzoj5384)</p>
<hr>
<p>ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥å½’ç»“ä¸ºã€ŒåŒºé—´æœ¬è´¨ä¸åŒå…ƒç´ ä¸ªæ•°ã€ã€‚è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªååˆ†å¸¸ç”¨çš„æ–¹æ³•ï¼š</p>
<blockquote>
<p>ç¦»çº¿è¯¢é—®ã€‚å¯¹äºä¸€ä¸ªå›ºå®šçš„å³ç«¯ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ï¼Œæˆ‘ä»¬å¯¹äºåœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>âˆ¼</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">1\sim i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸­å‡ºç°çš„å…ƒç´ ï¼Œåªåœ¨å®ƒå‡ºç°çš„æœ€å¤§ä½ç½®å¤„æ ‡è®°ã€‚ç„¶åæšä¸¾æ‰€æœ‰ä»¥è¯¥å³ç«¯ç‚¹ä¸ºç»“æŸä½ç½®çš„è¯¢é—®ï¼ŒæŸ¥è¯¢ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> ä¸­çš„æ ‡è®°ä¸ªæ•°ã€‚ç„¶åå°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> åç§»ï¼Œå°†å›  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> åç§»å¼•èµ·çš„æ–°å¢å…ƒç´ åœ¨å…¶åŸæœ€å¤§ä½ç½®å¤„çš„æ ‡è®°æ¶ˆå»ï¼Œå¹¶åœ¨æ–°æœ€å¤§ä½ç½®å¤„æ ‡è®°ã€‚</p>
</blockquote>
<blockquote>
<p>ç¦»çº¿è¯¢é—®ã€‚ç»´æŠ¤ç­”æ¡ˆåºåˆ— <code>ans[]</code> ã€‚<code>ans[i]</code> çš„å€¼å°±è¡¨ç¤ºå½“å‰æƒ…å†µä¸‹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>i</mi><mo separator="true">,</mo><mi>r</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[i,r]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">]</span></span></span></span> çš„ç­”æ¡ˆã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> åç§»æ—¶ï¼Œå¯¹äºæ¯ä¸ªæ–°å¢çš„å…ƒç´  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span> ï¼Œå‡åœ¨ç­”æ¡ˆåºåˆ—ä¸­çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mtext>pos</mtext><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>l</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[\text{pos}+1,l]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord text"><span class="mord">pos</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mclose">]</span></span></span></span> å¤„ +1 ï¼Œå…¶ä¸­ pos æ˜¯è¯¥å…ƒç´ ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼Œl æ˜¯è¯¥å…ƒç´ æœ¬æ¬¡å‡ºç°çš„ä½ç½®ã€‚åœ¨å¤„ç†å®Œ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> åç§»åé¡ºä¾¿å¤„ç†è¯¢é—®ã€‚</p>
</blockquote>
<p>å®é™…åº”ç”¨ä¸­ï¼Œä¸»è¦çœ‹å„æ“ä½œæ‰€ç»´æŠ¤çš„æ˜¯å¦å¯ä»¥<strong>è¿æˆä¸€æ®µ</strong>ï¼Œä»¥é€šè¿‡æ•°æ®ç»“æ„åŠ é€Ÿå¤„ç†ã€‚<br>
åœ¨ä¸¤ä¸ªé—®é¢˜ä¸­ï¼Œåˆ†åˆ«å°†ã€ŒåŒºé—´æœ¬è´¨ä¸åŒå­ä¸²ã€å’Œã€ŒåŒºé—´æœ¬è´¨ä¸åŒå›æ–‡å­ä¸²ã€è§†ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…¶å‡ºç°çš„ä½ç½®çš„å·¦ç«¯ç‚¹è§†ä¸ºã€Œå…ƒç´ çš„ä½ç½®ã€ã€‚</p>
<hr>
<p>é¦–å…ˆè€ƒè™‘ã€ŒåŒºé—´æœ¬è´¨ä¸åŒå­ä¸²ã€ã€‚<br>
å‡è®¾å³ç«¯ç‚¹åç§»åä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ï¼Œé‚£ä¹ˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> çš„æ‰€æœ‰æ–°å¢å­ä¸²ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>[</mo><mi>k</mi><mo>:</mo><mi>i</mi><mo>]</mo><mo>(</mo><mi>k</mi><mo>âˆˆ</mo><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mi>i</mi><mo>]</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">s[k:i](k\in [1,i])</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">i</span><span class="mclose">]</span><span class="mclose">)</span></span></span></span> ã€‚æ‰€ä»¥æ–°å¢æ ‡è®°çš„æ“ä½œå¾ˆå¥½å®Œæˆï¼Œåªéœ€è¦åŒºé—´ +1 å°±å¯ä»¥äº†ã€‚è€ƒè™‘å¦‚ä½•æ‰¾åˆ°åŸæœ€å¤§ä½ç½®ã€‚</p>
<p>åœ¨ parent æ ‘ä¸Šè€ƒè™‘è¿™äº›æ–°å¢å­ä¸²ï¼Œå…¶å¿…ç„¶æ˜¯ä¸€æ¡è‡ªåº•å‘ä¸Šçš„é“¾ã€‚å¦‚æœæˆ‘ä»¬å¯¹äºæ¯ä¸ªå­ä¸²è®°å½•å…¶æœ€åå‡ºç°çš„ä½ç½®çš„å³ç«¯ç‚¹ rps ï¼Œæ˜¾ç„¶ parent æ ‘ä¸Šçš„åŒä¸€ä¸ªèŠ‚ç‚¹ä»£è¡¨çš„é‚£äº›å­ä¸² rps éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æœ€åå‡ºç°çš„ä½ç½®çš„å·¦ç«¯ç‚¹æ˜¯ä¸€æ®µåŒºé—´è€Œå·²ã€‚æ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªæš´åŠ›çš„æ€è·¯ï¼šé€çº§è·³ link ï¼Œæ‰¾åˆ°èŠ‚ç‚¹ä»£è¡¨çš„å·¦ç«¯ç‚¹åŒºé—´ï¼ŒåŒºé—´ -1 ã€‚ä½†æ˜¯æš´åŠ›è·³ link å¤æ‚åº¦æ˜¯ä¸å¯å–çš„ã€‚</p>
<p>å®é™…ä¸Šï¼Œå‡è®¾æˆ‘è¿™æ¬¡æ–°å¢äº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ï¼Œé‚£ä¹ˆ <code>s[1:i]</code> ä»£è¡¨çš„å­ä¸²å¯¹åº”çš„èŠ‚ç‚¹ä¸€ç›´åˆ°æ ¹çš„è¿™æ¡é“¾çš„ rps éƒ½æ˜¯ä¸€æ ·çš„ã€‚ç„¶åå·¦ç«¯ç‚¹åŒºé—´å½“ç„¶ä¹Ÿæ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥å¯ä»¥æ‹¼æˆä¸€ä¸ªæ›´å¤§çš„å·¦ç«¯ç‚¹ï¼ŒåŠ é€Ÿä¿®æ”¹è¿‡ç¨‹ã€‚é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä½•æ‰¾åˆ°å‘ä¸Šçš„æœ€é•¿ç›¸åŒ rps æ®µã€‚æˆ‘ä»¬å¯ä»¥å°† rps çš„èµ‹å€¼è§†ä½œæ˜¯æŸ“è‰²æ“ä½œã€‚</p>
<p>å¯¹äºã€Œæ¯æ¬¡å°†æŸä¸ªèŠ‚ç‚¹åˆ°æ ¹æŸ“æˆåŒä¸€ç§æœªæ›¾å‡ºç°è¿‡çš„é¢œè‰²ã€è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LCT ä¸­çš„ access æ¥å®ç°ã€‚è¿™ä¹Ÿæ˜¯ä¸ªç»å…¸ trick ã€‚ä¸€æ¡å®é“¾ä¸Šçš„ç‚¹é¢œè‰²ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰¾åˆ°å®é“¾é¡¶ç«¯å¹¶ä¿®æ”¹ã€‚</p>
<p>access çš„å‡æ‘Šå¤æ‚åº¦æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªçº¿æ®µæ ‘æ¥æ”¯æŒåŒºé—´ä¿®æ”¹ï¼Œæ‰€ä»¥æ€»çš„å¤æ‚åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msubsup><mi>log</mi><mo>â¡</mo><mn>2</mn><mn>2</mn></msubsup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log^2_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span>ã€‚</p>
<p>äºæ˜¯è¿™é“é¢˜å¯ä»¥ç”¨ç¬¬ä¸€ç§æ–¹æ³•æ¥å®ç°ã€‚<br>
å½“ç„¶ï¼Œç¬¬äºŒç§æ–¹æ³•ä¹Ÿå¯ä»¥åšã€‚å› ä¸º pos åˆšå¥½æ˜¯é€ä¸€é€’å‡çš„ï¼Œä¹Ÿå°±ç›¸å½“äºåœ¨ access å†…æˆ‘ä»¬æ¯æ¬¡åœ¨ç­”æ¡ˆåºåˆ—ä¸ŠåŒºé—´åŠ ä¸€ä¸ªç­‰å·®æ•°åˆ—ã€‚</p>
<p>ä»£ç é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p>
<pre><code class="language-cpp">const int N=1e5+5,M=2e5+5;
int n;
namespace SAM{
    int tot=1,las=1;
    int pos[N];
    struct node{
        int l,link,c[26];
    }a[N&lt;&lt;1];
    int extend(int k){
        int p=las,cur=las=++tot;a[cur].l=a[p].l+1;
        while(p&amp;&amp;!a[p].c[k]) a[p].c[k]=cur,p=a[p].link;
        if(!p) return a[cur].link=1,cur;
        int q=a[p].c[k];
        if(a[q].l==a[p].l+1) return a[cur].link=q,cur;
        int now=++tot;a[now]=a[q];
        a[q].link=a[cur].link=now,a[now].l=a[p].l+1;
        while(p&amp;&amp;a[p].c[k]==q) a[p].c[k]=now,p=a[p].link;
        return cur;
    }
    void build(char *s){
        int len=strlen(s+1);
        for(int i=1;i&lt;=len;++i)
            pos[i]=extend(s[i]-'a');
    }
}
using namespace SAM;
using namespace std;
namespace SEG{
#define mid (l+r&gt;&gt;1)
#define ls p&lt;&lt;1,l,mid
#define rs p&lt;&lt;1|1,mid+1,r
    long long t[N&lt;&lt;2],tag[N&lt;&lt;2];
    void update(int p){
        t[p]=t[p&lt;&lt;1]+t[p&lt;&lt;1|1];
    }
    void pushmk(int p,int l,int r,long long v){
        t[p]+=1ll*(r-l+1)*v;
        tag[p]+=v;
    }
    void pushdn(int p,int l,int r){
        if(!tag[p]) return;
        pushmk(ls,tag[p]);
        pushmk(rs,tag[p]);
        tag[p]=0; 
    }
    void modify(int p,int l,int r,int nl,int nr,int v){
        if(l&gt;=nl&amp;&amp;r&lt;=nr) return pushmk(p,l,r,v),void();
        if(l&gt; nr||r&lt; nl) return;
        pushdn(p,l,r);
        modify(ls,nl,nr,v),modify(rs,nl,nr,v);
        update(p);
    }
    long long query(int p,int l,int r,int nl,int nr){
        if(l&gt;=nl&amp;&amp;r&lt;=nr) return t[p];
        if(l&gt; nr||r&lt; nl) return 0;
        pushdn(p,l,r);
        return query(ls,nl,nr)+query(rs,nl,nr);
    }
}
namespace LCT{
#define lc(x) c[x][0]
#define rc(x) c[x][1]
    int fa[N&lt;&lt;1],tag[N&lt;&lt;1],rps[N&lt;&lt;1],c[N&lt;&lt;1][2]; 
    bool nrt(int x){
        return lc(fa[x])==x||rc(fa[x])==x;
    }
    void pushmk(int x,int v){
        tag[x]=rps[x]=v;
    }
    void pushdn(int x){
        pushmk(lc(x),tag[x]);
        pushmk(rc(x),tag[x]);
        tag[x]=0;
    }
    void rotate(int x){
        int y=fa[x],z=fa[y],t=rc(y)==x;
        if(nrt(y)) c[z][rc(z)==y]=x;fa[x]=z;
        c[y][t]=c[x][t^1];fa[c[x][t^1]]=y;
        c[x][t^1]=y;fa[y]=x;
    }
    void pushall(int x){
        if(nrt(x)) pushall(fa[x]);
        if(tag[x]) pushdn(x);
    }
    void splay(int x){
        pushall(x);
        while(nrt(x)){
            int y=fa[x],z=fa[y];
            if(nrt(y))
                ((rc(z)==y)^(rc(y)==x))?rotate(x):rotate(y);
            rotate(x);
        }
    }
    void access(int x,int p){
        int old=x;
        for(int i=0;x;x=fa[i=x]){
            splay(x);rc(x)=i;
            if(int v=rps[x])
                SEG::modify(1,1,n,v-a[x].l+1,v-a[fa[x]].l,-1);
        }
        SEG::modify(1,1,n,1,p,1);
        splay(old);pushmk(old,p);
    }
    void build(){
        for(int i=2;i&lt;=tot;++i)
            fa[i]=a[i].link;
    }
}

struct Query{
    int l,r,id;
    bool operator &lt;(const Query &amp;b)const{
        if(r==b.r) return l&lt;b.l;
        return r&lt;b.r;
    }
}q[M];
long long ans[M];
char s[N];
int main(){

    scanf(&quot;%s&quot;,s+1);n=strlen(s+1);
    build(s);LCT::build();
    int m;scanf(&quot;%d&quot;,&amp;m);
    for(int i=1;i&lt;=m;++i)
        r(q[i].l),r(q[i].r),q[i].id=i;
    sort(q+1,q+m+1);
    for(int i=1,j=1;i&lt;=m;++i){
        while(j&lt;=q[i].r)
            LCT::access(pos[j],j),++j;
        ans[q[i].id]=SEG::query(1,1,n,q[i].l,q[i].r);
    }
    for(int i=1;i&lt;=m;++i)
        w(ans[i]),putchar(10);
    return 0;
}
</code></pre>
<hr>
<p>æ¥ä¸‹æ¥è€ƒè™‘ ã€ŒåŒºé—´æœ¬è´¨ä¸åŒå›æ–‡å­ä¸²ã€ã€‚<br>
æ‰€æœ‰çš„æ–°å¢å›æ–‡å­ä¸²æ˜¯ fail æ ‘ä¸Šçš„ä¸€æ¡é“¾ã€‚ä½†æˆ‘ä»¬æ€ä¹ˆå¿«é€ŸçŸ¥é“æ¯ä¸ªèŠ‚ç‚¹çš„ä¸Šä¸€æ¬¡å‡ºç°ä½ç½®å‘¢ã€‚<br>
å›æ–‡å­ä¸²çš„æœ€é•¿å›æ–‡åç¼€æœ‰å¦‚ä¸‹æ€§è´¨</p>
<blockquote>
<p>å›æ–‡å­ä¸²çš„æœ€é•¿å›æ–‡åç¼€æ˜¯åŸå›æ–‡å­ä¸²çš„ border ã€‚</p>
</blockquote>
<p>åŒæ—¶ border æœ‰å¦‚ä¸‹æ€§è´¨</p>
<blockquote>
<p>å°†ä¸€ä¸ªä¸²çš„æ‰€æœ‰ border åˆ†æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ç»„ç­‰å·®æ•°åˆ—ï¼Œåˆ™ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">\log_2n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span></span></span></span> çº§åˆ«çš„ï¼ˆè§„å®šç­‰å·®æ•°åˆ—çš„å‰ä¸€é¡¹é•¿åº¦ä¸å¤§äºåä¸€é¡¹çš„ä¸€åŠï¼‰ã€‚æ­¤å¤„çš„ç­‰å·®æ•°åˆ—ä¸ä»…æ˜¯é•¿åº¦æ„ä¹‰ä¸Šçš„ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²æœ¬èº«æ„ä¹‰ä¸Šçš„ã€‚</p>
</blockquote>
<p>æœ‰äº†æœ€é•¿å›æ–‡åç¼€çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™æ ·ä¸€ä¸ªä¼˜ç¾çš„äº‹å®ï¼š<br>
<img src="https://parallelist-c.github.io/post-images/1610356993384.png" alt="" loading="lazy"><br>
å¦‚ä¸Šå›¾ï¼Œ p ä¸º s çš„æœ€é•¿å›æ–‡åç¼€ï¼Œq ä¸º p çš„æœ€é•¿å›æ–‡åç¼€ã€‚ç”±äº p åˆæ˜¯ s çš„å‰ç¼€ä¸” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><mi>p</mi><mi mathvariant="normal">âˆ£</mi><mo>â‰¥</mo><mfrac><mrow><mi mathvariant="normal">âˆ£</mi><mi>s</mi><mi mathvariant="normal">âˆ£</mi></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">|p|\geq \frac{|s|}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault">p</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ£</span><span class="mord mathdefault mtight">s</span><span class="mord mtight">âˆ£</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> ï¼Œæ‰€ä»¥ p çš„ä¸Šæ¬¡å‡ºç°ä½ç½®å¿…ç„¶æ˜¯ s çš„å‰ç¼€é‚£å„¿ï¼›åŒç†ï¼Œq çš„ä¸Šæ¬¡å‡ºç°ä½ç½®å¿…ç„¶æ˜¯ p çš„å‰ç¼€é‚£å„¿ï¼Œæ‰€ä»¥é™¤äº† s ä¹‹å¤–ï¼Œå…¶ä½™ä½ç½®çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>l</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[pos+1,l]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mclose">]</span></span></span></span> åˆšå¥½å¯ä»¥æ‹¼æˆä¸€ä¸ªè¿ç»­åŒºé—´ ğŸ»ã€‚å¦‚æœè®¾å½“å‰å³ç«¯ç‚¹æ‰©å±•åˆ° i ï¼Œè¯¥ç­‰å·®æ•°åˆ—çš„æœ€å°ä¸²çš„ç›®å‰èµ·å§‹ä½ç½®ä¸º P ï¼Œé‚£ä¹ˆè¿™äº›ä¸²çš„è´¡çŒ®åŒºé—´æ°å¥½ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>i</mi><mo>âˆ’</mo><mi mathvariant="normal">âˆ£</mi><mi>s</mi><mi mathvariant="normal">âˆ£</mi><mo>+</mo><mn>2</mn><mo separator="true">,</mo><mi>P</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[i-|s|+2,P]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord mathdefault">s</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mclose">]</span></span></span></span> ï¼›å¦‚æœçŸ¥é“äº† s çš„ä¸Šæ¬¡å‡ºç°ä½ç½® Pos ï¼Œé‚£ä¹ˆå½“å‰çš„è´¡çŒ®å°±æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>P</mi><mi>o</mi><mi>s</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>P</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[Pos+1,P]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mclose">]</span></span></span></span> ã€‚</p>
<p>é—®é¢˜è½¬åŒ–ä¸º s çš„ä¸Šæ¬¡å‡ºç°ä½ç½®ã€‚æŸä¸ªä¸²çš„æ‰€æœ‰å‡ºç°ä½ç½®ä¸€å®šåœ¨å…¶ fail æ ‘çš„å­æ ‘çš„å‡ºç°ä½ç½®çš„å¹¶é›†ä¸­ã€‚ç”±äºåœ¨ fail æ ‘ä¸Šï¼ŒæŸä¸ªå­æ ‘å†…çš„å­ä¸²å³ç«¯ç‚¹ä¸€è‡´ï¼Œå¹¶ä¸”æˆ‘ä»¬åªéœ€è¦ s å‡ºç°ä½ç½®çš„å³ç«¯ç‚¹æœ€å¤§å€¼ï¼Œä¹Ÿèƒ½æ¨å‡ºæ¥å®ƒçš„å·¦ç«¯ç‚¹æœ€å¤§å€¼ï¼Œæ•…æˆ‘ä»¬åœ¨ fail æ ‘ä¸Šç»™æ¯ä¸ªèŠ‚ç‚¹èµ‹å€¼ä¸ºè¯¥èŠ‚ç‚¹ä»£è¡¨å­ä¸²ç›®å‰å‡ºç°ä½ç½®çš„å³ç«¯ç‚¹æœ€å¤§å€¼ï¼Œç„¶åæŸ¥è¯¢å°±æ˜¯å­æ ‘æŸ¥è¯¢ï¼ˆè½¬ DFS åºç„¶åä¸Šçº¿æ®µæ ‘ï¼‰ï¼Œä¿®æ”¹å°±æ˜¯å•ç‚¹ä¿®æ”¹ã€‚</p>
<p>æ‰€ä»¥å¯¹äºåŒä¸€ä¸ªç­‰å·®æ•°åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·å¤„ç†ã€‚</p>
<p>å†æ ¹æ® border çš„æ€§è´¨ï¼Œå¤æ‚åº¦ä¹Ÿå¾—åˆ°äº†ä¿è¯ã€‚å¤æ‚åº¦åº”ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msubsup><mi>log</mi><mo>â¡</mo><mn>2</mn><mn>2</mn></msubsup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log^2_{2}{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-2.4530000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<p>è¿™é“é¢˜å¦‚æœé‡‡ç”¨ç¬¬ä¸€ç§ç¦»çº¿å°±ä¸å¥½åšã€‚ä½†æ˜¯ç¬¬äºŒç§ç¦»çº¿å°±å¯ä»¥å……åˆ†å‘æ˜æ€§è´¨ã€‚</p>
<p>ä»£ç </p>
<pre><code class="language-cpp">namespace SEG{
#define mid (l+r&gt;&gt;1)
#define ls p&lt;&lt;1,l,mid
#define rs p&lt;&lt;1|1,mid+1,r
    int t[N&lt;&lt;2];
    void modify(int p,int l,int r,int pos,int v){
        t[p]=v;
        if(l==r) return;
        if(mid&gt;=pos) modify(ls,pos,v);
        else modify(rs,pos,v);
    }
    int query(int p,int l,int r,int nl,int nr){
        if(l&gt;=nl&amp;&amp;r&lt;=nr) return t[p];
        if(l&gt; nr||r&lt; nl) return 0;
        return max(query(ls,nl,nr),query(rs,nl,nr));
    }
}
namespace BIT{
#define lowb(x) (x&amp;-x)
    int t[N];
    void add(int p,int v){
        for(int i=p;i&lt;N;i+=lowb(i))
            t[i]+=v;
    }
    int query(int p){
        int ret=0;
        for(int i=p;i;i-=lowb(i))
            ret+=t[i];
        return ret;
    }
}
namespace PAM{
    int dfn,las,top,tot;
    int inp[N],out[N],dif[N],upp[N],pos[N];
    vector&lt;int&gt;g[N];
    struct node{
        int len,fail,c[26];
    }a[N];
    int getfail(int x){
        while(s[top]!=s[top-a[x].len-1])
            x=a[x].fail;
        return x;
    }
    void extend(int k){
        ++top;
        int cur=getfail(las);
        if(!a[cur].c[k]){
            int now=++tot;
            a[now].len=a[cur].len+2;
            a[now].fail=a[getfail(a[cur].fail)].c[k];
            dif[now]=a[now].len-a[a[now].fail].len;
            upp[now]=dif[now]==dif[a[now].fail]?upp[a[now].fail]:now;
            a[cur].c[k]=now;
        }
        las=a[cur].c[k];
    }
    void dfs(int p){
        inp[p]=++dfn;
        for(auto v:g[p])
            dfs(v);
        out[p]=dfn;
    }
    void build(char *s){
        int len=strlen(s+1);
        las=tot=1;top=0;
        a[0].len=0,a[1].len=-1;
        a[0].fail=a[1].fail=1;
        for(int i=1;i&lt;=len;++i)
            extend(s[i]-'a'),pos[i]=las;
        g[1].push_back(0);
        for(int i=2;i&lt;=tot;++i)
            g[a[i].fail].push_back(i);
        dfs(1);
    }
    void solve(){
        for(int i=1,now=1;i&lt;=n;++i){
            for(int j=pos[i];j;j=a[upp[j]].fail){
                int l=max(1,SEG::query(1,1,dfn,inp[j],out[j])-a[j].len+2);
                int r=i-a[upp[j]].len+1;
                BIT::add(l,1);BIT::add(r+1,-1);
            }
            SEG::modify(1,1,dfn,inp[pos[i]],i);
            while(q[now].r==i)
                ans[q[now].id]=BIT::query(q[now].l),++now;
        }
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€ç±»æ ‘å½¢ dp æ–¹ç¨‹çš„å¯æ¢æ ¹åŒ–å¤„ç†]]></title>
        <id>https://parallelist-c.github.io/post/yi-lei-shu-xing-dp-fang-cheng-de-ke-huan-gen-hua-chu-li/</id>
        <link href="https://parallelist-c.github.io/post/yi-lei-shu-xing-dp-fang-cheng-de-ke-huan-gen-hua-chu-li/">
        </link>
        <updated>2021-01-11T00:01:14.000Z</updated>
        <content type="html"><![CDATA[<p>æ¢æ ¹ dp æ˜¯ä¸€ä¸ªå¹¿ä¸ºæµä¼ çš„ç®—æ³•ã€‚<br>
æ¢æ ¹ dp å¯¹äº dp æ–¹ç¨‹æ˜¯æœ‰è¦æ±‚çš„ï¼Œä¸€èˆ¬è€Œè¨€ dp æ–¹ç¨‹ä¸­åªèƒ½å«æœ‰å¸¸æ•°å’Œä¸ i çš„å­æ ‘æœ‰å…³çš„é¡¹ã€‚<br>
æœ¬æ–‡å°†æ¢è®¨å¯¹äºä¸‹è¿°æ–¹ç¨‹å¦‚ä½•ä½¿å…¶å¯ä»¥æ¢æ ¹å¤„ç†</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><mo>(</mo><munder><mo>âˆ‘</mo><mi>e</mi></munder><msub><mi>w</mi><mi>e</mi></msub><mo>Ã—</mo><mi>f</mi><mo>[</mo><mi>s</mi><mi>o</mi><mi>n</mi><mo>]</mo><mo>)</mo><mo>+</mo><msub><mtext>dep</mtext><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">f[p]=(\sum_{e} w_e\times f[son])+\text{dep}_p
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mclose">]</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0746879999999999em;vertical-align:-0.380248em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252000000000025em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.380248em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<hr>
<p>æˆ‘ä»¬å‡è®¾ä»¥ 1 ä¸ºæ ¹ä¸” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>dep</mtext><mn>1</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{dep}_1=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> ã€‚<br>
è€ƒè™‘å°†è´¡çŒ®å½’åˆ°æ¯ä¸ªç‚¹ä¸Šï¼Œé‚£ä¹ˆå½“ç›®å‰æšä¸¾åˆ°å­æ ‘ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> çš„å­æ ‘å†…çš„ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> çš„è´¡çŒ®åº”è¯¥æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>dep</mtext><mi>x</mi></msub><mo>Ã—</mo><mo>âˆ</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">\text{dep}_x\times \prod w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.00001em;vertical-align:-0.25001em;"></span><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ã€‚<br>
æ¢æ ¹ dp çš„æ–¹ç¨‹ä¸­ä¸èƒ½æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>dep</mtext></mrow><annotation encoding="application/x-tex">\text{dep}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">dep</span></span></span></span></span> ï¼Œæ•…æˆ‘ä»¬å°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>dep</mtext><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">\text{dep}_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span></span></span></span> æ‹†åˆ°ä» <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> åˆ°æ ¹çš„æ¯ä¸€æ¡è¾¹ä¸Šã€‚å¹¶ä¸”å°†æ¯ä¸€æ¡è¾¹ä¸ä¸å…¶ç›¸è¿çš„å­èŠ‚ç‚¹å¯¹åº”ã€‚æ¢å¥è¯è¯´ï¼Œå½“æšä¸¾åˆ°å­æ ‘ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> æ—¶ï¼Œæˆ‘ä»¬åªè®¡ç®— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> çš„å­æ ‘å†…<strong>é™¤ p ä»¥å¤–</strong>çš„èŠ‚ç‚¹çš„<strong>ç›¸å¯¹æ·±åº¦+1</strong>çš„è´¡çŒ®ï¼ˆå¦‚æœç†è§£äº†å°†è¾¹è§†ä½œç›¸è¿çš„å­èŠ‚ç‚¹ä¸Šçš„è¯ï¼Œé‚£ä¹ˆ +1 ä¹Ÿå¥½ç†è§£äº†ï¼‰ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> çš„è´¡çŒ®ç•™åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> çš„çˆ¶èŠ‚ç‚¹è®¡ç®—ã€‚<br>
å¸¦å…¥æ•°å€¼è€ƒè™‘å¯èƒ½å½¢è±¡ä¸€ç‚¹ã€‚å½“æšä¸¾åˆ°å­æ ‘ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> æ—¶ï¼Œå‡è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> çš„ç›¸å¯¹æ·±åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> ï¼Œè·¯å¾„æƒå€¼ä¹‹ç§¯ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> ï¼Œé‚£ä¹ˆå½“æšä¸¾åˆ°å­æ ‘ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>fa</mtext><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">\text{fa}_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord text"><span class="mord">fa</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> çš„è´¡çŒ®ä¼šå‘ç”Ÿå˜åŒ–ï¼š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>Ã—</mo><mi>b</mi><mo>â†’</mo><mo>(</mo><mi>a</mi><mo>+</mo><mn>1</mn><mo>)</mo><mo>Ã—</mo><mi>b</mi><mo>Ã—</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">a\times b\rightarrow (a+1)\times b\times w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â†’</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://parallelist-c.github.io/post-images/1610326579855.png" alt="" loading="lazy"></figure>
<p>å°†ä¹‹åçš„è´¡çŒ®æ‹†å¼€æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>Ã—</mo><mi>b</mi><mo>Ã—</mo><mi>w</mi><mo>+</mo><mi>b</mi><mo>Ã—</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">a\times b\times w+b\times w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ã€‚å‰é¢çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>Ã—</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a\times b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span> æ°å¥½æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> ä¹‹å‰çš„è´¡çŒ®ï¼Œæˆ‘ä»¬ç›´æ¥è®¾ä¸º <code>f[p]</code>ï¼Œè¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> çš„å­æ ‘å†…é™¤ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ä»¥å¤–çš„èŠ‚ç‚¹çš„ç›¸å¯¹æ·±åº¦+1çš„è´¡çŒ®ï¼›é‚£ä¹ˆé—®é¢˜å°±åœ¨äºåé¢çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo>Ã—</mo><mi>w</mi></mrow><annotation encoding="application/x-tex">b\times w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span> ï¼Œä¹Ÿå°±æ˜¯è·¯å¾„æƒå€¼ä¹‹ç§¯çš„å’Œã€‚æˆ‘ä»¬å•ç‹¬è®¾ <code>g[p]</code> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> å­æ ‘å†…è·¯å¾„æƒå€¼ä¹‹ç§¯çš„å’Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—åˆ°è½¬ç§»æ–¹ç¨‹ä¸º</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><munder><mo>âˆ‘</mo><mi>e</mi></munder><msub><mi>w</mi><mi>e</mi></msub><mo>Ã—</mo><mi>g</mi><mo>[</mo><mi>s</mi><mi>o</mi><mi>n</mi><mo>]</mo><mo>+</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>f</mi><mo>[</mo><mi>p</mi><mo>]</mo><mo>=</mo><munder><mo>âˆ‘</mo><mi>e</mi></munder><msub><mi>w</mi><mi>e</mi></msub><mo>Ã—</mo><mo>(</mo><mi>f</mi><mo>[</mo><mi>s</mi><mi>o</mi><mi>n</mi><mo>]</mo><mo>+</mo><mi>g</mi><mo>[</mo><mi>s</mi><mi>o</mi><mi>n</mi><mo>]</mo><mo>)</mo><mo>+</mo><mn>1</mn><mo>=</mo><mo>(</mo><munder><mo>âˆ‘</mo><mi>e</mi></munder><msub><mi>w</mi><mi>e</mi></msub><mo>Ã—</mo><mi>f</mi><mo>[</mo><mi>s</mi><mi>o</mi><mi>n</mi><mo>]</mo><mo>)</mo><mo>+</mo><mi>g</mi><mo>[</mo><mi>p</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">g[p]=\sum_{e} w_e \times g[son]+1\\
f[p]=\sum_{e} w_e \times (f[son]+g[son])+1=(\sum_{e}w_e\times f[son]) +g[p]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mclose">]</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.3000100000000003em;vertical-align:-1.250005em;"></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.8999949999999999em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.250005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">[</span><span class="mord mathdefault">s</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mclose">]</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">+</span><span class="mord">1</span></span></span></span> åªæ˜¯æ–¹ä¾¿ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> åœ¨å‘ä¸Šä¼ é€’ä¸­ç´¯è®¡æƒå€¼ã€‚è¿™é‡Œéœ€è¦ä¸€ä¸ªå•ä½å…ƒã€‚<br>
ä¸Šè¿°æ–¹ç¨‹æ˜¯å¯ä»¥è¿›è¡Œæ¢æ ¹å¤„ç†çš„ã€‚æˆ‘ä»¬æˆåŠŸåœ°è½¬åŒ–äº†é—®é¢˜ã€‚</p>
<p>æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼šæˆ‘ä»¬å°† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>dep</mtext><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">\text{dep}_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span></span></span></span> æ‹†åˆ°äº†è¾¹ä¸Šï¼Œå¹¶ä¸”å°†è¾¹å¯¹åº”åˆ°äº†ç›¸è¿çš„å…¶å­èŠ‚ç‚¹ä¸Šã€‚ç”±äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>dep</mtext><mn>1</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{dep}_1=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> ï¼Œæ•…æˆ‘ä»¬æœ€ç»ˆç®—å‡ºæ¥çš„ <code>f</code> å€¼åªæœ‰åœ¨ç¬¬äºŒå±‚æ‰æ˜¯å‡†ç¡®çš„ï¼ˆè´¡çŒ®åªåˆ°äº†ç¬¬äºŒå±‚çš„çˆ¶è¾¹å°±åœæ­¢äº†ï¼‰ï¼›è€Œå¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mtext>dep</mtext><mn>1</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{dep}_1=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord"><span class="mord text"><span class="mord">dep</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€ç»ˆç®—å‡ºæ¥çš„ f å€¼å°±åªæœ‰æ ¹æ˜¯å‡†ç¡®çš„ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Luogu4299 é¦–éƒ½ è§£é¢˜æŠ¥å‘Š]]></title>
        <id>https://parallelist-c.github.io/post/luogu4299-shou-du/</id>
        <link href="https://parallelist-c.github.io/post/luogu4299-shou-du/">
        </link>
        <updated>2021-01-09T05:00:16.000Z</updated>
        <content type="html"><![CDATA[<h2 id="description">Description</h2>
<p>æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> ä¸ªç‚¹ï¼Œåˆå§‹æ—¶äº’ä¸è¿é€šã€‚æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> æ¬¡æ“ä½œï¼Œåˆ†åˆ«ä¸ºå¦‚ä¸‹ä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>è¿æ¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mtext>Â </mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">x\ y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">x</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> ä¸¤ä¸ªç‚¹ã€‚ä¿è¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mtext>Â </mtext><mi>y</mi></mrow><annotation encoding="application/x-tex">x\ y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">x</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span> ä¸è¿é€šã€‚</li>
<li>è¯¢é—®ç¼–å·ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span> çš„ç‚¹æ‰€åœ¨çš„æ ‘çš„é‡å¿ƒçš„ç¼–å·ã€‚</li>
<li>è¯¢é—®å½“å‰æ‰€æœ‰æ ‘çš„é‡å¿ƒçš„ç¼–å·å¼‚æˆ–å’Œã€‚</li>
</ul>
<p>é‡å¿ƒå®šä¹‰ä¸ºæŸä¸ªä½¿å¾—å…¶ä»–ç‚¹åˆ°å®ƒçš„è·ç¦»ä¹‹å’Œæœ€å°çš„ç‚¹ã€‚æœ‰å¤šä¸ªé‡å¿ƒæ—¶é€‰æ‹©ç¼–å·æœ€å°çš„ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup><mo separator="true">,</mo><mi>m</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n\leq 10^5,m\leq 2\times 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p>é‡å¿ƒçš„æ€§è´¨å¾ˆä¼˜ç¾ï¼Œå¤§è‡´æ¥è¯´æœ‰å››ä¸ªï¼š</p>
<ul>
<li>æ ‘ä¸­æ‰€æœ‰ç‚¹åˆ°æŸä¸ªç‚¹çš„è·ç¦»å’Œä¸­ï¼Œåˆ°é‡å¿ƒçš„è·ç¦»å’Œæ˜¯æœ€å°çš„ã€‚</li>
<li>ä»¥æ ‘çš„é‡å¿ƒä¸ºæ ¹æ—¶ï¼Œé™¤æ ¹èŠ‚ç‚¹ä»¥å¤–æ‰€æœ‰èŠ‚ç‚¹çš„å­æ ‘å¤§å°å‡ä¸è¶…è¿‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{n}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.040392em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>  ã€‚</li>
<li>æŠŠä¸¤æ£µæ ‘é€šè¿‡æŸä¸€ç‚¹ç›¸è¿å¾—åˆ°ä¸€é¢—æ–°çš„æ ‘ï¼Œæ–°çš„æ ‘çš„é‡å¿ƒå¿…ç„¶åœ¨è¿æ¥åŸæ¥ä¸¤æ£µæ ‘é‡å¿ƒçš„è·¯å¾„ä¸Šã€‚</li>
<li>å½“åœ¨åŸæ ‘ä¸Šæ–°å¢/åˆ é™¤ä¸€ä¸ªå¶å­èŠ‚ç‚¹æ—¶ï¼Œé‡å¿ƒè‡³å¤šç§»åŠ¨ä¸€æ¡è¾¹çš„è·ç¦»ã€‚</li>
</ul>
<p>å¯¹äºè¿™é“é¢˜è€Œè¨€ï¼Œç¬¬äºŒæ¡å’Œç¬¬ä¸‰æ¡å®åœ¨æ˜¯å†å¥½ä¸è¿‡äº†ã€‚<br>
è¿™é‡Œç®€è¦è¯æ˜ä»¥ä¸‹ç¬¬ä¸‰æ¡æ€§è´¨ã€‚ä¸åœ¨è·¯å¾„ä¸Šçš„ç‚¹åœ¨åŸæ ‘ä¸Šçš„å­æ ‘å¤§å°ä¸è¶…è¿‡åŸæ ‘å¤§å°çš„ä¸€åŠï¼Œé‚£ä¹ˆå½“åˆ å»å®ƒçš„å­æ ‘åä¸å°äºåŸæ ‘å¤§å°çš„ä¸€åŠã€‚è€Œåˆ å»å®ƒçš„å­æ ‘åçš„è¿™ä¸ªè¿é€šå—å®Œæ•´ç»§æ‰¿äº†å¦ä¸€æ£µæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ•…è¿é€šå—çš„å¤§å°ä¸€å®šå¤§äºæ–°æ ‘å¤§å°çš„ä¸€åŠã€‚<br>
æœ‰äº†ä¸Šè¿°æ€§è´¨ï¼Œæˆ‘ä»¬å°±å°†é‡å¿ƒçš„èŒƒå›´é™åˆ¶åœ¨äº†ä¸€æ¡é“¾ä¸Šã€‚<br>
é“¾ä¸Šçš„ç‚¹é™¤äº†å‘ä¸¤ä¸ªé‡å¿ƒæ–¹å‘çš„å­æ ‘å¤–ï¼Œå…¶ä½™çš„å­æ ‘çš„å¤§å°ä¸€å®šå°äºæ–°æ ‘å¤§å°çš„ä¸€åŠã€‚æˆ‘ä»¬åªéœ€è€ƒè™‘é“¾ä¸Šçš„ç‚¹å‘ä¸¤ä¸ªé‡å¿ƒæ–¹å‘çš„å­æ ‘ã€‚ç”¨ splay ç»´æŠ¤è¿™æ¡é“¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹é¢å¤–ä»£è¡¨é“¾ä¸Šçš„ä¸€ä¸ªåŒºé—´ï¼Œåˆ°è¾¾èŠ‚ç‚¹æ—¶æ¯”è¾ƒ å·¦/å³å­èŠ‚ç‚¹çš„å¤§å°ä¸åŒºé—´å·¦ç«¯ç‚¹ä»¥å·¦ï¼ˆlsumï¼‰/å³ç«¯ç‚¹ä»¥å³çš„å¤§å°ï¼ˆrsumï¼‰ä¹‹å’Œï¼ˆä¹Ÿå°±æ˜¯è¯¥èŠ‚ç‚¹å‘ç€ä¸¤ä¸ªé‡å¿ƒçš„å­æ ‘å¤§å°ï¼‰ ä¸æ–°æ ‘å¤§å°çš„ä¸€åŠçš„å¤§å°ã€‚å¦‚æœå‡ä¸ºä¸å¤§äºï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹è‡ªç„¶å°±æ˜¯é‡å¿ƒå•¦ï¼›å¦åˆ™æ›´æ–° lsum/rsum ï¼Œå†è¿›å…¥å­æ ‘å¤§å°è¾ƒå¤§çš„é‚£ä¸€è¾¹ç»§ç»­æ‰¾ã€‚<br>
å¯èƒ½è®²å¾—æœ‰äº›å¤æ‚äº†ï¼Œå®é™…ä¸Šåªè¦çœ‹æ‡‚äº†è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚ç±»ä¼¼äºæ ‘ä¸ŠäºŒåˆ†å˜›ã€‚</p>
<p>é—®é¢˜è½¬åŒ–ä¸ºè¦æ±‚å–å‡ºæ ‘ä¸Šä¸€æ¡é“¾ï¼Œå¹¶ä¸”ç”¨ splay ç»´æŠ¤å®ƒã€‚å½“ç„¶æ˜¯ LCT å•¦ã€‚</p>
<p>å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>m</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code">Code</h2>
<pre><code class="language-cpp">const int N=1e5+6;
using namespace std;
namespace LCT{
#define lc(x) c[x][0]
#define rc(x) c[x][1]
    int sz[N],fa[N],vir[N],tag[N],c[N][2]; 
    inline bool nrt(int x){return lc(fa[x])==x || rc(fa[x])==x;}
    inline void update(int x){
        sz[x]=sz[lc(x)]+sz[rc(x)]+vir[x]+1;
    }
    inline void revers(int x){
        tag[x]^=1;swap(lc(x),rc(x));
    }
    inline void pushdn(int x){
        revers(lc(x)),revers(rc(x)),tag[x]=0;
    }
    inline void rotate(int x){
        int y=fa[x],z=fa[y],t=rc(y)==x;
        if(nrt(y)) c[z][rc(z)==y]=x;fa[x]=z;
        c[y][t]=c[x][t^1];fa[c[x][t^1]]=y;
        c[x][t^1]=y;fa[y]=x;
        update(y),update(x);
    }
    void pushall(int x){
        if(nrt(x)) pushall(fa[x]);
        if(tag[x]) pushdn(x);
    }
    inline void splay(int x){
        pushall(x);
        while(nrt(x)){
            int y=fa[x],z=fa[y];
            if(nrt(y))
                ((rc(y)==x)^(rc(z)==y))?rotate(x):rotate(y);
            rotate(x);
        }
    }
    inline void access(int x){
        for(int i=0;x;x=fa[i=x])
            splay(x),vir[x]+=sz[rc(x)],rc(x)=i,vir[x]-=sz[i],update(x);
    }
    inline void makert(int x){
        access(x);splay(x);revers(x);
    }
    inline void split(int x,int y){
        makert(x);access(y);splay(y);
    }
    inline void link(int x,int y){
        split(x,y);fa[x]=y;vir[y]+=sz[x];update(y);
    }
    int solve(int x){
        int Max=sz[x]&gt;&gt;1,Jud=sz[x]&amp;1,lsum=0,rsum=0,ret=0x3f3f3f3f;
        while(x){
            if(tag[x]) pushdn(x);
            int nowl=lsum+sz[lc(x)],nowr=rsum+sz[rc(x)];
            if(nowl&lt;=Max&amp;&amp;nowr&lt;=Max)
                if(Jud){ret=x;break;}
                else if(ret&gt;x) ret=x;
            if(nowl&lt;nowr) lsum+=sz[x]-sz[rc(x)],x=rc(x);
            else rsum+=sz[x]-sz[lc(x)],x=lc(x);
        }
        return ret;
    }
}
using namespace LCT;
int n,m,f[N];
int Find(int x){return f[x]==x?x:f[x]=Find(f[x]);}
int main(){

    scanf(&quot;%d%d&quot;,&amp;n,&amp;m);
    int ans=0;
    for(int i=1;i&lt;=n;++i) sz[i]=1,f[i]=i,ans^=i;
    char s[10];
    for(int i=1,x,y;i&lt;=m;++i){
        scanf(&quot;%s&quot;,s);
        if(s[0]=='X') w(ans),putchar(10);
        else if(s[0]=='Q') scanf(&quot;%d&quot;,&amp;x),w(Find(x)),putchar(10);
        else{
            scanf(&quot;%d%d&quot;,&amp;x,&amp;y);link(x,y);
            split(x=Find(x),y=Find(y));
            int now=solve(y);
            f[x]=f[y]=f[now]=now;
            ans^=x^y^now;
        }
    }
    return 0;
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Quiz 0107 Summary]]></title>
        <id>https://parallelist-c.github.io/post/quiz-0107-summary/</id>
        <link href="https://parallelist-c.github.io/post/quiz-0107-summary/">
        </link>
        <updated>2021-01-08T13:22:46.000Z</updated>
        <content type="html"><![CDATA[<h1 id="t1-word">T1 word</h1>
<h2 id="description">Description</h2>
<p>ä½ æœ‰ä¸€ä¸ªç”±å°å†™å­—æ¯ç»„æˆçš„é•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸€æ­¥ä½ è¦æ‰¾åˆ°å®ƒçš„å­ä¸²ä¸­æœ€çŸ­çš„é‡å¤å—ï¼ˆä¸€ä¸ªé‡å¤å—ç”±ä¸€ä¸ªå­—ç¬¦ä¸²ä¸è‡ªèº«è¿æ¥è€Œæˆï¼‰ã€‚å¦‚æœæœ‰å¤šäºä¸€ä¸ªï¼Œä½ å¿…é¡»é€‰æ‹©æœ€å·¦è¾¹çš„é‚£ä¸ªã€‚ä½ è¦å°†é‚£ä¸ªå½¢å¦‚ XX(X - æŸä¸ªå­—ç¬¦ä¸²)çš„é‡å¤å—æ›¿æ¢æˆ Xï¼Œå³åˆ é™¤å…¶ä¸­çš„ä¸€ä¸ª Xã€‚é‡å¤ä»¥ä¸Šæ­¥éª¤ç›´åˆ°å­—ç¬¦ä¸²ä¸­ä¸å­˜åœ¨é‡å¤å—ã€‚<br>
è¾“å‡ºæœ€ç»ˆçš„å­—ç¬¦ä¸²ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>â‰¤</mo><mn>5</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">n\leq 5\times 10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p>åˆ¤æ–­ä¸²ä¸­ä»»æ„ä½ç½®çš„é‡å¤å—é™¤äº†å“ˆå¸Œè²Œä¼¼ä¹Ÿæ²¡æœ‰åˆ«çš„æ–¹æ³•ã€‚SAM å•Š exkmp å•Š ACAM å•Šéƒ½æŸæ‰‹æ— ç­–ã€‚<br>
ä½†æ˜¯æ‰¾æ‰€æœ‰çš„é‡å¤å—æœ‰ä¸€ä¸ªç»å…¸çš„ trick ï¼šæšä¸¾å¯èƒ½çš„é‡å¤ä¸²é•¿åº¦ len ï¼Œåœ¨åŸå­—ç¬¦ä¸²ä¸­æ¯éš” len æ’æ ‡ï¼Œæ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªæ ‡çš„ lcp+lcs ä¸ len çš„å¤§å°ï¼Œå³å¯åˆ¤æ–­æ­¤å¤„æ˜¯å¦å­˜åœ¨é•¿åº¦ä¸º len çš„é‡å¤ä¸²ã€‚æ±‚ç›¸é‚»ä¸¤ä¸ªæ ‡çš„ lcp å’Œ lcs éƒ½å¯ä»¥å“ˆå¸Œ+äºŒåˆ†ã€‚<br>
å¹¶ä¸”è¿™ä¸ª trick æœ‰ä¸ªä¼˜åŠ¿ï¼šæ¯æ¬¡æ‰¾åˆ°çš„é‡å¤ä¸²ä¸€å®šæ˜¯ç›®å‰é•¿åº¦æœ€å°ä¸”èµ·å§‹ä½ç½®æœ€é å·¦çš„ã€‚<br>
æ°å¥½é€‚åˆè¿™é“é¢˜ç›®å‘¢ğŸ¤ã€‚<br>
ä½†æ˜¯æ¯æ¬¡ä¿®æ”¹å®Œè¦åˆ é™¤å•Šï¼Œè¿™ä¸€åˆ é™¤å“ˆå¸Œæ•°ç»„å°±å¾—é‡æ„äº†ã€‚<br>
å¤§ä¸ˆå¤«ã§ã™ ï¼æ¯æ¬¡æ‰¾åˆ° len é•¿åº¦ä¸‹çš„æ‰€æœ‰é‡å¤å—å¹¶ä¸€èµ·é‡æ„ã€‚è¿™æ ·è‡³å¤šé‡æ„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msqrt><mi>n</mi></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.23972em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault">n</span></span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span></span></span></span> æ¬¡ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mi>ln</mi><mo>â¡</mo><mi>n</mi><mo>+</mo><mi>n</mi><msqrt><mi>n</mi></msqrt><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log_2{n}\ln{n}+n\sqrt{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">ln</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.05028em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8002800000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathdefault">n</span></span></span><span style="top:-2.76028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.23972em;"><span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code">Code</h2>
<pre><code class="language-cpp">int LCP(int p1,int p2){
    int l=1,r=Maxpre,ret=0;
    while(r&gt;=l){
        int mid=l+r&gt;&gt;1;
        if(geth(p1-mid+1,p1)==geth(p2-mid+1,p2)) ret=mid,l=mid+1;
        else r=mid-1;
    }
    return ret;
}
int LCS(int p1,int p2){
    int l=1,r=p2-p1,ret=0;
    while(r&gt;=l){
        int mid=l+r&gt;&gt;1;
        if(geth(p1,p1+mid-1)==geth(p2,p2+mid-1)) ret=mid,l=mid+1;
        else r=mid-1;
    }
    return ret;
}
int main(){

    scanf(&quot;%s&quot;,s+1);
    int n=strlen(s+1);
    p[0]=1;
    for(int i=1;i&lt;=n;++i)
        p[i]=p[i-1]*B,w[i]=1ull*B*(w[i-1]+s[i]-'a'+1);
    for(int len=1;len&lt;=n/2;++len){
        bool flag=0;
        int j=len,k=len&lt;&lt;1;Maxpre=len;
        while(k&lt;=n){
            int lcp=LCP(j,k),lcs=LCS(j,k);
            if(lcp+lcs&gt;len){
                for(int i=j-lcp+1;i&lt;=j-lcp+len;++i)
                    del[i]=len;
                flag=true;Maxpre=lcp; // æ³¨æ„ Maxpre ã€‚è¦é¿å…è¿™æ¬¡çš„ lcs å½±å“åˆ°ä¸‹æ¬¡çš„ lcp ã€‚
            }
            else Maxpre=len;
            j+=len,k+=len;
        }
        if(!flag) continue;
        int cnt=0;
        for(int i=1;i&lt;=n;++i)
            if(del[i]^len) 
                s[++cnt]=s[i],w[cnt]=1ull*B*(w[cnt-1]+s[i]-'a'+1);
        n=cnt;
    }
    for(int i=1;i&lt;=n;++i)
        putchar(s[i]);
    return 0;
}
</code></pre>
<h1 id="t2-dream">T2 dream</h1>
<h2 id="description-2">Description</h2>
<p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„ä»…å«å°å†™å­—æ¯çš„å­—ç¬¦ä¸²ã€‚æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æ¬¡æ“ä½œï¼Œæ¯æ¬¡å½¢å¦‚ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mtext>Â </mtext><mi>r</mi></mrow><annotation encoding="application/x-tex">l\ r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace">Â </span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> ï¼Œè¦æ±‚å°† <code>s[l:r]</code> å˜ä¸ºå­—å…¸åºæœ€å°çš„å›æ–‡ä¸²ï¼ˆè‹¥æ— è§£åˆ™å¿½ç•¥ï¼‰ã€‚è¾“å‡ºæœ€åçš„å­—ç¬¦ä¸²ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>â‰¤</mo><mn>5</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">n\leq 5\times 10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-2">Solution</h2>
<p>è€ƒè™‘å°† <code>s[l:r]</code> å˜ä¸ºå›æ–‡ä¸²çš„è¿‡ç¨‹ï¼šæšä¸¾æ¯ä¸ªå­—ç¬¦ï¼Œå‡è®¾æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šåœ¨å·¦/å³æŒ‡é’ˆå¤„åˆ†åˆ«æ’å…¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>d</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{d}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> ä¸ªï¼Œç„¶åå·¦/å³æŒ‡é’ˆå‡å‘ä¸­é—´é æ‹¢ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>d</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{d}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2251079999999999em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801079999999999em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> ï¼›å¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span></span></span></span> æ˜¯å¥‡æ•°ï¼Œç‰¹åˆ¤åç›´æ¥æ”¾åœ¨ä¸­é—´å³å¯ã€‚<br>
ä¼˜åŒ–ç©ºé—´åœ¨äºåŠ é€Ÿâ€œæ’å…¥â€çš„è¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªæœ¬è´¨ä¸Šå°±æ˜¯åŒºé—´è¦†ç›–ï¼Œæ•…å¯ä»¥è€ƒè™‘çº¿æ®µæ ‘ç»´æŠ¤ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>26</mn><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(26n\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">6</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code-2">Code</h2>
<pre><code class="language-cpp">struct node{
    int a[26];
    node(){memset(a,0,sizeof a);}
    node operator +(const node &amp;b)const{
        node ret;
        for(int i=0;i&lt;26;++i)
            ret.a[i]=b.a[i]+a[i];
        return ret;
    }
}t[N&lt;&lt;2];
namespace SEG{
#define mid (l+r&gt;&gt;1)
#define ls p&lt;&lt;1,l,mid
#define rs p&lt;&lt;1|1,mid+1,r
    int tag[N&lt;&lt;2];
    void pushup(int p){
        t[p]=t[p&lt;&lt;1]+t[p&lt;&lt;1|1];
    }
    void setval(int p,int l,int r,int v){
        t[p]=node();
        t[p].a[v]=(r-l+1);
        tag[p]=v;
    }
    void pushdn(int p,int l,int r,int v){
        setval(ls,v),setval(rs,v);tag[p]=-1;
    }
    void build(int p=1,int l=1,int r=n){
        tag[p]=-1;
        if(l==r) return ++t[p].a[s[l]-'a'],void();
        build(ls);build(rs);
        pushup(p);
    }
    void modify(int p,int l,int r,int nl,int nr,int v){
        if(l&gt;=nl&amp;&amp;r&lt;=nr) return setval(p,l,r,v),void();
        if(~tag[p]) pushdn(p,l,r,tag[p]);
        if(mid&gt;=nl) modify(ls,nl,nr,v);
        if(mid&lt; nr) modify(rs,nl,nr,v);
        pushup(p);
    }
    node query(int p,int l,int r,int nl,int nr){
        if(l&gt;=nl&amp;&amp;r&lt;=nr) return t[p];
        if(~tag[p]) pushdn(p,l,r,tag[p]);
        if(mid&gt;=nr) return query(ls,nl,nr);
        else if(mid&lt;nl) return query(rs,nl,nr);
        else return query(ls,nl,mid)+query(rs,mid+1,nr); 
    }
    void print(int p=1,int l=1,int r=n){
        if(l==r){
            for(int i=0;i&lt;26;++i)
                if(t[p].a[i]) {putchar(char(i+'a'));break;}
            return;
        }
        if(~tag[p]) pushdn(p,l,r,tag[p]);
        print(ls),print(rs);
    }
}
using namespace SEG;
int main(){

    scanf(&quot;%d%d&quot;,&amp;n,&amp;m);
    scanf(&quot;%s&quot;,s+1);
    build();
    for(int i=1,l,r;i&lt;=m;++i){
        scanf(&quot;%d%d&quot;,&amp;l,&amp;r);
        node sta=query(1,1,n,l,r);
        int L=l,R=r,times=(r-l+1)&amp;1;
        for(int j=0;j&lt;26;++j)
            times-=(sta.a[j]&amp;1);
        if(times) continue;
        for(int j=0;j&lt;26;++j){
            int d=sta.a[j]/2;
            if(d) modify(1,1,n,L,L+d-1,j);
            if(d) modify(1,1,n,R-d+1,R,j);
            L+=d,R-=d;
            if(sta.a[j]&amp;1)
                modify(1,1,n,mid,mid,j);
        }
    }
    print();
    return 0;
}
</code></pre>
<h1 id="t3-word">T3 word</h1>
<h2 id="description-3">Description</h2>
<p>æœ‰ä¸€ä¸ªé•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„ç”±å°å†™å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚å®šä¹‰æå¤§è¿ç»­ç›¸åŒçš„å­åºåˆ—ä¸º energy ã€‚å°†ç»™å®šçš„å­—ç¬¦ä¸²é‡æ–°æ’åˆ—ï¼Œæ±‚æœ‰å¤šå°‘ç§ä¸åŒçš„æ’åˆ—æ–¹å¼ä½¿å¾—å®ƒå’ŒåŸå­—ç¬¦ä¸²æœ‰ç›¸åŒæ•°é‡çš„ energy ã€‚å¯¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">10^6+3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> å–æ¨¡ã€‚<br>
ä¿è¯ energy çš„æ•°é‡ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> ä¸å¤šäº 100 ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>â‰¤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n\leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution-3">Solution</h2>
<p>å…³é”®åˆ‡å…¥ç‚¹å½“ç„¶æ˜¯ energy çš„æ•°é‡é™åˆ¶å•¦ã€‚<br>
è®¾ <code>f[i][j]</code> è¡¨ç¤ºè€ƒè™‘å‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ç§å­—ç¬¦ï¼Œå·²ç»ç»„æˆäº† <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ª energy çš„æ–¹æ¡ˆæ•°ï¼›<code>cnt[i]</code> è¡¨ç¤ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ç§å­—ç¬¦çš„ä¸ªæ•°ï¼›<code>sum[i]</code> è¡¨ç¤º <code>cnt</code> çš„å‰ç¼€å’Œã€‚<br>
æ’å…¥ç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ç§å­—ç¬¦æ—¶ï¼Œæ–°å¢çš„ energy çš„æ¥æºæœ‰ä¸¤å¤„â€”â€”ç›´æ¥æ’å…¥äº§ç”Ÿçš„ energy å’Œåˆ†éš”å¼€åŸæœ‰çš„ energy äº§ç”Ÿçš„ energy ã€‚è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> è¡¨ç¤ºåŸæœ‰çš„ energy ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> è¡¨ç¤ºå½“å‰ç›´æ¥æ’å…¥çš„ energy ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span> è¡¨ç¤ºå› åˆ†éš”è€Œäº§ç”Ÿçš„ energy ã€‚å¯å¾—åˆ°è½¬ç§»æ–¹ç¨‹å¼ä¸º</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>[</mo><mi>j</mi><mo>+</mo><mi>k</mi><mo>+</mo><mi>l</mi><mo>]</mo><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo>[</mo><mi>j</mi><mo>]</mo><mo>Ã—</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><msub><mtext>cnt</mtext><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></mfrac><mo fence="true">)</mo></mrow><mo>Ã—</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><msub><mtext>sum</mtext><mi>i</mi></msub><mo>âˆ’</mo><mi>j</mi></mrow><mi>l</mi></mfrac><mo fence="true">)</mo></mrow><mo>Ã—</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>âˆ’</mo><mi>l</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_{i+1}[j+k+l]=f_{i}[j]\times \binom{\text{cnt}_{i+1}-1}{k-1}\times\binom{\text{sum}_i-j}{l}\times\binom{j+1}{k-l}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">cnt</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord text"><span class="mord">sum</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span><span style="top:-3.6770000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span></span></span></span></span></p>
<p>è€ƒè™‘è½¬ç§»æ–¹ç¨‹å¼çš„æ„ä¹‰ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><msub><mtext>cnt</mtext><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow></mfrac><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\binom{\text{cnt}_{i+1}-1}{k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2984390000000001em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.895108em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">cnt</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32808571428571426em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.20252142857142857em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> è¡¨ç¤ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> ç§å­—ç¬¦ç»„æˆ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> ä¸ª energy çš„æ–¹æ¡ˆæ•°ï¼Œç„¶åæ˜¯ä¸ªç»å…¸éš”æ¿æ³•ï¼›è€ƒè™‘æ’å…¥çš„å…·ä½“æƒ…å†µï¼šæœ€å¼€å¤´ä»¥åŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> ä¸ª energy çš„æœ«å°¾æ’å…¥æ—¶éƒ½ä¸ä¼šé€ æˆåˆ†éš”ï¼Œè¿™éƒ¨åˆ†çš„æ–¹æ¡ˆæ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>k</mi><mo>âˆ’</mo><mi>l</mi></mrow></mfrac><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\binom{j+1}{k-l}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.308995em;vertical-align:-0.403331em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.905664em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.403331em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> ï¼Œå…¶ä½™çš„ä½ç½®æ’å…¥æ—¶ä¼šé€ æˆå› åˆ†éš”è€Œäº§ç”Ÿçš„ energy ï¼Œè¿™éƒ¨åˆ†çš„æ–¹æ¡ˆæ•°ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><msub><mtext>sum</mtext><mi>i</mi></msub><mo>âˆ’</mo><mi>j</mi></mrow><mi>l</mi></mfrac><mo fence="true">)</mo></mrow><annotation encoding="application/x-tex">\binom{\text{sum}_i-j}{l}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.255674em;vertical-align:-0.35001em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9056639999999999em;"><span style="top:-2.3550000000000004em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">sum</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3280857142857143em;"><span style="top:-2.357em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span> ã€‚<br>
å¤æ‚åº¦ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mo>+</mo><mn>26</mn><msup><mi>m</mi><mn>3</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n+26m^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord">6</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<h2 id="code-3">Code</h2>
<pre><code class="language-cpp">const int N=1e5+5,M=1e2+5,Mod=1e6+3;
using namespace std;
char s[N];
int f[M],g[M],sum[26],cnt[26],c[N][M];
inline int Plus(int a,int b){return a+b&gt;=Mod?a+b-Mod:a+b;}
int main(){

    scanf(&quot;%s&quot;,s+1);
    int n=strlen(s+1),tot=0;
    for(int i=1;i&lt;=n;++i)
        tot+=(s[i]!=s[i-1]);
    for(int i=1;i&lt;=n;++i)
        ++cnt[s[i]-'a'];
    sum[0]=cnt[0];
    for(int i=1;i&lt;26;++i)
        sum[i]=sum[i-1]+cnt[i];
    c[0][0]=c[1][0]=1;
    for(int i=1;i&lt;=n;++i,c[i][0]=1)
    for(int j=1;j&lt;=i&amp;&amp;j&lt;=tot;++j)
        c[i][j]=Plus(c[i-1][j-1],c[i-1][j]);
    f[bool(sum[0])]=1;
    for(int i=1;i&lt;26;++i){
        if(!cnt[i]) continue;
        memset(g,0,sizeof g);
        for(int j=0;j&lt;=tot&amp;&amp;j&lt;=sum[i-1];++j)
        for(int k=1;j+k&lt;=tot&amp;&amp;k&lt;=cnt[i];++k)
        for(int l=0;j+k+l&lt;=tot&amp;&amp;l&lt;=k;++l){
            int now=1ll*f[j]*c[j+1][k-l]%Mod*c[cnt[i]-1][k-1]%Mod*c[sum[i-1]-j][l]%Mod;
            g[j+k+l]=Plus(g[j+k+l],now);
        }
        for(int j=0;j&lt;=tot;++j) f[j]=g[j];
    }
    printf(&quot;%d\n&quot;,f[tot]);
    return 0;
}
</code></pre>
<h1 id="analysis">Analysis</h1>
<p>T1 å¤±è¯¯åœ¨äºå®Œå…¨ä¸è®°å¾— trick äº†ã€‚åšé¢˜é‡è¦å¢åŠ ã€‚</p>
<p>T2 å¤±è¯¯åœ¨äºæœªæƒ³æ¸…æ¥šè´¸ç„¶åŠ¨æ‰‹ã€‚è§‰å¾—ç»´æŠ¤åºåˆ—ç”¨ splay å†å¥½ä¸è¿‡äº†ï¼Œè€Œä¸”ä¼¼ä¹åªéœ€è¦åœ¨æ¯ä¸ªèŠ‚ç‚¹æ‰¾åˆ°å½“å‰ä½ç½®åœ¨æœ€ç»ˆå›æ–‡ä¸²ä¸­æ˜¯ä»€ä¹ˆå­—æ¯ï¼Œå†æ‰“ä¸ªæ ‡è®°å°±è¡Œäº†ã€‚ä¸è¦æµ…å°è¾„æ­¢å•Š QAQ ğŸ˜­  è¿™ä¸ªæ ‡è®°çœŸçš„å¯ä»¥ä¸‹ä¼ å—ï¼Ÿï¼<strong>ç”¨æ•°æ®ç»“æ„ç»´æŠ¤æ—¶ä¸ä»…è¦çŸ¥é“æ‰“æ‡’æ ‡è®°ï¼Œæ›´è¦æƒ³æ¸…æ¥šæ‡’æ ‡è®°èƒ½ä¸èƒ½ä¸‹ä¼ ï¼Œæ€ä¹ˆä¸‹ä¼ </strong>ã€‚</p>
<p>T3 è€ƒè¯•çš„æ—¶å€™å®Œå…¨æ²¡æƒ³ï¼Œè€ƒåä¹Ÿæ²¡æœ‰æ€è·¯ã€‚ä»å­—ç¬¦å’Œæå¤§è¿ç»­ç›¸åŒå­—ç¬¦ä¸²å…¥æ‰‹è®¾ç½®çŠ¶æ€çš„æ€æƒ³å¾ˆå¦™ã€‚æšä¸¾çš„æ—¶å€™è¦å­¦ä¼š<strong>æšä¸¾æ®µ</strong>çš„æ¦‚å¿µï¼Œè€Œä¸è¦å±€é™äºç‚¹ã€‚ç‚¹åˆ°<strong>æ®µ</strong>åªéœ€è¦ä¸€ä¸ªéš”æ¿æ³•ï¼Œè€Œæ®µå¯ä»¥çœå»è¶…çº§å¤šçš„è®¨è®ºï¼Œç”¨èµ·æ¥å¾ˆå®ç”¨ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[CF700E Cool Slogans è§£é¢˜æŠ¥å‘Š]]></title>
        <id>https://parallelist-c.github.io/post/cf700e-cool-slogans-jie-ti-bao-gao/</id>
        <link href="https://parallelist-c.github.io/post/cf700e-cool-slogans-jie-ti-bao-gao/">
        </link>
        <updated>2021-01-07T09:23:29.000Z</updated>
        <content type="html"><![CDATA[<h2 id="description">Description</h2>
<p>ç»™å®šé•¿åº¦ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> çš„å­—ç¬¦ä¸² s ï¼Œè¦æ±‚æ„é€ å­—ç¬¦ä¸²åºåˆ— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>â‹¯</mo><mtext>â€‰</mtext><mo separator="true">,</mo><msub><mi>s</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">s_1,s_2,\cdots,s_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">â‹¯</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ï¼Œæ»¡è¶³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ€</mi><mi>i</mi><mo>âˆˆ</mo><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\forall i\in[1,k]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord">âˆ€</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span></span></span></span> ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ s çš„å­ä¸²ï¼Œä¸” <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ€</mi><mi>i</mi><mo>âˆˆ</mo><mo>[</mo><mn>2</mn><mo separator="true">,</mo><mi>k</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\forall i\in[2,k]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord">âˆ€</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">]</span></span></span></span>ï¼Œ éƒ½æœ‰ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸­è‡³å°‘å‡ºç°äº†ä¸¤æ¬¡ï¼ˆå¯ä»¥æœ‰é‡å éƒ¨åˆ†ï¼‰ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ä¸èƒ½ä¸ºç©ºã€‚æ±‚æœ€å¤§çš„ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> å€¼ã€‚<br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>â‰¤</mo><mi>n</mi><mo>â‰¤</mo><mn>2</mn><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">1\leq n\leq 2\times 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.78041em;vertical-align:-0.13597em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="solution">Solution</h2>
<p>æœ‰çš„æ—¶å€™åšé¢˜æ²¡æœ‰çµæ„Ÿï¼Œç¿»é¢˜è§£æ—¶ä¼šå‘ç°é¢˜è§£å…ˆç»™å®šäº†å‡ æ¡ååˆ†æ˜¾ç„¶çš„ç»“è®ºï¼Œç„¶åæ€è·¯å°±æ‰“å¼€äº†ã€‚ç»“è®ºè™½ç„¶æ˜¾ç„¶ï¼Œä½†é—®é¢˜å°±åœ¨äºè‡ªå·±æƒ³ä¸åˆ°ï¼Œæˆ–è€…è¯´ï¼Œä¸æ˜ç™½è‡ªå·±ä¸ºä»€ä¹ˆè¦å¾€é‚£æ–¹é¢æƒ³ğŸ˜“ã€‚</p>
<p>æ¯”å¦‚è¿™é“é¢˜ã€‚æœ‰ä¸€ä¸ªå¾ˆå¥½è¯æ˜çš„ç»“è®ºå°±æ˜¯ï¼š</p>
<blockquote>
<p>å­˜åœ¨è‡³å°‘ä¸€ç§æ–¹æ¡ˆï¼Œæ»¡è¶³ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ€</mi><mi>i</mi><mo>âˆˆ</mo><mo>[</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">\forall i\in[1,k-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord">âˆ€</span><span class="mord mathdefault">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> çš„åç¼€ã€‚</p>
</blockquote>
<p>è¯æ˜å¯ä»¥è¿™æ ·è€ƒè™‘ï¼šå¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> åé¢è¿˜å¤šäº†ä¸€æ®µï¼Œåˆ å»è¿™æ®µä½¿å¾— <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æˆä¸ºåç¼€åå¯¹äºåºåˆ—å¹¶æ— å½±å“ã€‚</p>
<p>äºæ˜¯æœ€ç»ˆçš„åºåˆ—ä¸€å®šæ˜¯ parent æ ‘ä¸Šçš„ä¸€æ¡é“¾ä¸Šé€‰è‹¥å¹²ä¸ªã€‚ä¼¼ä¹å¯ä»¥ç”¨æ ‘å½¢ dp æ¥å¤„ç†ã€‚è®¾ <code>f[u]</code> è¡¨ç¤ºç¬¬ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> ä¸ªèŠ‚ç‚¹åŠå…¶ç¥–å…ˆå¯ä»¥æ„æˆçš„æœ€é•¿åºåˆ—çš„é•¿åº¦ã€‚<br>
è€ƒè™‘è½¬ç§»çš„æ¡ä»¶ã€‚å¯¹äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> åŠå…¶ç¥–å…ˆèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ï¼Œè‹¥ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> åœ¨æŸä¸ª $u ä»£è¡¨çš„å­—ç¬¦ä¸²ä¸­å‡ºç°ä¸¤æ¬¡åˆ™æ‰§è¡Œ <code>f[u]=f[v]+1</code> ï¼Œå¦åˆ™æ‰§è¡Œ <code>f[u]=f[v]</code> ã€‚é—®é¢˜è½¬åŒ–ä¸ºäº†å¦‚ä½•åˆ¤å®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> åœ¨æŸä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> ä»£è¡¨çš„å­—ç¬¦ä¸²ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚<br>
èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> æœ‰ä¸æ­¢ä¸€ä¸ª endpos éš¾é“éœ€è¦ä¸€ä¸€æšä¸¾å†åˆ†åˆ«åˆ¤å®šå—ï¼Ÿæˆ‘ä»¬å…ˆé’¦å®šåˆ¤å®š <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> çš„ç¬¬ä¸€ä¸ª endpos ä½ç½® <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ï¼Œ é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>p</mi><mo>âˆ’</mo><mi>a</mi><mo>[</mo><mi>u</mi><mo>]</mo><mi mathvariant="normal">.</mi><mi>l</mi><mo>+</mo><mi>a</mi><mo>[</mo><mi>v</mi><mo>]</mo><mi mathvariant="normal">.</mi><mi>l</mi><mo separator="true">,</mo><mi>p</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[p-a[u].l+a[v].l,p]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault">u</span><span class="mclose">]</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">]</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span> èŒƒå›´å†…æŸ¥è¯¢ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> çš„ endpos æ•°ç›®ï¼Œè¿™ä¸ªèŒƒå›´æ˜¯å±äº <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>p</mi><mo>âˆ’</mo><mi>a</mi><mo>[</mo><mi>u</mi><mo>]</mo><mi mathvariant="normal">.</mi><mi>l</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>p</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">[p-a[u].l+1,p]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault">u</span><span class="mclose">]</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span> çš„ï¼Œå³å¯¹äºæ¯ä¸ªç»“æŸèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>[</mo><mi>p</mi><mo>âˆ’</mo><mi>a</mi><mo>[</mo><mi>u</mi><mo>]</mo><mi mathvariant="normal">.</mi><mi>l</mi><mo>+</mo><mi>a</mi><mo>[</mo><mi>v</mi><mo>]</mo><mi mathvariant="normal">.</mi><mi>l</mi><mo separator="true">,</mo><mi>p</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">s[p-a[u].l+a[v].l,p]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mopen">[</span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault">u</span><span class="mclose">]</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mclose">]</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mclose">]</span></span></span></span> è¿™ä¸ªå­—ç¬¦ä¸²éƒ½å¿…ç„¶æ˜¯ä¸€æ ·çš„ï¼Œäºæ˜¯æˆ‘ä»¬åªè¦ä»»æ„åˆ¤å®šä¸€ä¸ªå°±è¡Œäº†ã€‚<br>
è‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n^2\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> çš„ dp ï¼šæšä¸¾ parent æ ‘ä¸Šçš„ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> åŠå…¶ç¥–å…ˆèŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> å¹¶å°è¯•æ›´æ–°ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬æœ‰å¿…è¦æšä¸¾æ¯ä¸ªç¥–å…ˆå—ï¼Ÿå¦‚æœ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> ä¸èƒ½ç”±å…¶çˆ¶èŠ‚ç‚¹ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> è½¬ç§»è¿‡æ¥ï¼Œé‚£ä¹ˆç”¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> å»æ›´æ–° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> çš„å­èŠ‚ç‚¹è‚¯å®šä¸ä¼šæ›´åŠ£ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">u</span></span></span></span> ç»™å‹ç¼©åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span></span></span></span> ä¸­å»ã€‚<br>
å¤æ‚åº¦æˆåŠŸä¼˜åŒ–åˆ° <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><msub><mi>log</mi><mo>â¡</mo><mn>2</mn></msub><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log_2{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">n</span></span><span class="mclose">)</span></span></span></span> ã€‚</p>
<pre><code class="language-cpp">const int N=4e5+5;
using namespace std;
namespace SEG{
#define mid (l+r&gt;&gt;1)
#define Ls c[p][0],l,mid
#define Rs c[p][1],mid+1,r
    int tot;
    int t[N&lt;&lt;5],c[N&lt;&lt;5][2];
    void modify(int &amp;p,int l,int r,int pos){
        p=++tot;t[p]=1;
        if(l==r) return;
        if(pos&lt;=mid) modify(Ls,pos);
        else modify(Rs,pos);
    }
    void merge(int &amp;p,int x,int l,int r){
        if(!p||!x) return p=p|x,void();
        int now=++tot;
        c[now][0]=c[p][0],c[now][1]=c[p][1];t[now]=t[p]+t[x];p=now;
        if(l==r) return;
        merge(c[p][0],c[x][0],l,mid);
        merge(c[p][1],c[x][1],mid+1,r);
    }
    int query(int p,int l,int r,int nl,int nr){
        if(!p) return 0;
        if(l&gt;=nl&amp;&amp;r&lt;=nr) return t[p];
        int ret=0;
        if(mid&gt;=nl) ret+=query(Ls,nl,nr);
        if(mid&lt; nr) ret+=query(Rs,nl,nr);
        return ret;
    }
}
using namespace SEG;
namespace SAM{
    int tot,las;
    int f[N],g[N],ba[N],rk[N],rt[N],pos[N];
    struct node{
        int l,link,c[26];
    }a[N];
    void insert(int k,int id){
        int p=las,cur=las=++tot;
        a[cur].l=a[p].l+1;pos[cur]=id;
        while(p&amp;&amp;!a[p].c[k]) a[p].c[k]=cur,p=a[p].link;
        if(!p) return a[cur].link=1,void();
        int q=a[p].c[k];
        if(a[q].l==a[p].l+1) return a[cur].link=q,void();
        int now=++tot;a[now]=a[q];a[now].l=a[p].l+1;
        a[q].link=a[cur].link=now;pos[now]=pos[q];
        while(p&amp;&amp;a[p].c[k]==q) a[p].c[k]=now,p=a[p].link;
    }
    void basesort(){
        for(int i=1;i&lt;=tot;++i) ++ba[a[i].l];
        for(int i=1;i&lt;=tot;++i) ba[i]+=ba[i-1];
        for(int i=1;i&lt;=tot;++i) rk[ba[a[i].l]--]=i;
    }
    void build(char *s){
        tot=las=1;
        int len=strlen(s+1);
        for(int i=1;i&lt;=len;++i)
            insert(s[i]-='a',i);
        for(int i=1,u=1;i&lt;=len;++i)
            u=a[u].c[int(s[i])],modify(rt[u],1,len,i);
        basesort();
        for(int i=tot,u=rk[i];i&gt;=2;--i,u=rk[i])
            merge(rt[a[u].link],rt[u],1,len);
        int ans=1;f[1]=1;g[1]=1;
        for(int i=2,u=rk[i];i&lt;=tot;++i,u=rk[i]){
            int fa=a[u].link;
            if(fa==1){
                f[u]=1,g[u]=u;continue;
            }
            if(query(rt[g[fa]],1,len,pos[u]-a[u].l+a[g[fa]].l,pos[u]-1))
                f[u]=f[fa]+1,g[u]=u;
            else f[u]=f[fa],g[u]=g[fa];
            ans=max(ans,f[u]);
        }
        printf(&quot;%d\n&quot;,ans);
    }
}
</code></pre>
]]></content>
    </entry>
</feed>